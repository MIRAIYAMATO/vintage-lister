<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VintageLister v98 - Desktop Station</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --color-primary: #3b82f6;
            --color-primary-dark: #2563eb;
            --color-primary-light: #dbeafe;
            --color-success: #22c55e;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --color-surface: #ffffff;
            --color-background: #f1f5f9;
            --color-text: #1e293b;
            --color-text-muted: #64748b;
            --color-border: #e2e8f0;
        }
        * { box-sizing: border-box; }
        html, body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; margin: 0; padding: 0; height: 100vh; overflow: hidden; }
        
        .desktop-layout { display: grid; grid-template-columns: 420px 1fr 280px; height: 100vh; }
        .form-panel { background: var(--color-surface); display: flex; flex-direction: column; overflow: hidden; }
        .camera-panel { background: #000; display: flex; flex-direction: column; }
        .photos-panel { background: var(--color-background); overflow-y: auto; padding: 16px; border-left: 1px solid var(--color-border); }
        
        /* FLOATING TIMER - Always visible */
        .floating-timer {
            position: sticky; top: 0; z-index: 10;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white; padding: 12px 16px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 12px rgba(59,130,246,0.3);
        }
        .timer-main { font-size: 28px; font-weight: 800; font-family: monospace; }
        .timer-stats { text-align: right; font-size: 11px; opacity: 0.9; }
        .timer-label { font-size: 10px; opacity: 0.7; }
        
        /* PROGRESS BAR */
        .progress-bar {
            display: flex; justify-content: center; gap: 8px;
            padding: 12px 16px; background: var(--color-background);
            border-bottom: 1px solid var(--color-border);
        }
        .progress-dot {
            width: 12px; height: 12px; border-radius: 50%;
            background: var(--color-border); cursor: pointer;
            transition: all 0.2s;
        }
        .progress-dot.active { background: var(--color-primary); transform: scale(1.3); }
        .progress-dot.complete { background: var(--color-success); }
        .progress-label { font-size: 10px; color: var(--color-text-muted); font-weight: 600; }
        
        /* STEP CONTAINER */
        .step-area { flex: 1; overflow-y: auto; padding: 16px; }
        .step-container { display: none; }
        .step-container.active { display: block; }
        
        .section-card { background: var(--color-background); border: 1px solid var(--color-border); border-radius: 12px; padding: 14px; margin-bottom: 12px; }
        .section-label { font-size: 12px; font-weight: 700; color: var(--color-text); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        .check-circle { width: 20px; height: 20px; border-radius: 50%; background: var(--color-border); color: #999; display: flex; align-items: center; justify-content: center; font-size: 11px; }
        .check-circle.complete { background: var(--color-success); color: white; }
        
        .btn { padding: 10px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; border: 2px solid transparent; transition: all 0.1s; text-align: center; }
        .btn:active { transform: scale(0.97); }
        .btn-tertiary { background: white; color: var(--color-text-muted); border: 1px solid var(--color-border); }
        .btn-tertiary:hover { background: var(--color-background); }
        .btn-tertiary.selected { border: 2px solid var(--color-primary) !important; background: var(--color-primary) !important; color: white !important; }
        .btn-default { background: #e0f2fe; color: #0369a1; border: 2px dashed #7dd3fc; }
        .btn-default:hover { background: #bae6fd; }
        .btn-default.selected { border: 2px solid var(--color-primary) !important; background: var(--color-primary) !important; color: white !important; }
        .btn-hero { background: var(--color-primary); color: white; font-size: 14px; padding: 14px; }
        .btn-hero:hover { background: var(--color-primary-dark); }
        .btn-secondary { background: white; color: var(--color-text); border: 2px solid var(--color-border); }
        .btn-grid { display: grid; gap: 8px; }
        .btn-grid-2 { grid-template-columns: repeat(2, 1fr); }
        .btn-grid-3 { grid-template-columns: repeat(3, 1fr); }
        .btn-grid-4 { grid-template-columns: repeat(4, 1fr); }
        
        .form-input { width: 100%; padding: 10px 12px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 14px; }
        .form-input:focus { outline: none; border-color: var(--color-primary); }
        
        .sub-label { font-size: 11px; color: var(--color-text-muted); font-weight: 600; margin: 10px 0 8px 0; }
        .nested-section { background: rgba(59,130,246,0.05); border: 1px solid rgba(59,130,246,0.2); border-radius: 8px; padding: 12px; margin-top: 10px; }
        
        /* Super Category Buttons */
        .super-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 16px 12px; font-size: 11px; font-weight: 700; }
        .super-btn .emoji { font-size: 24px; }
        .super-btn.selected { background: var(--color-primary) !important; color: white !important; border-color: var(--color-primary) !important; }
        
        /* Category hero buttons */
        .cat-hero { background: var(--color-primary); color: white; padding: 16px; font-size: 15px; font-weight: 700; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .cat-hero:hover { background: var(--color-primary-dark); }
        .cat-hero.selected { box-shadow: 0 0 0 4px rgba(59,130,246,0.3); }
        .cat-secondary { background: white; color: var(--color-text); border: 2px solid var(--color-border); padding: 12px; font-size: 13px; font-weight: 600; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .cat-secondary:hover { background: var(--color-background); }
        .cat-secondary.selected { border-color: var(--color-primary); background: var(--color-primary-light); }
        .cat-other { background: white; color: var(--color-text-muted); border: 1px solid var(--color-border); padding: 8px; font-size: 11px; font-weight: 600; border-radius: 6px; cursor: pointer; }
        .cat-other.selected { border-color: var(--color-primary); background: var(--color-primary); color: white; }
        
        /* Color grid */
        .color-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .color-btn { aspect-ratio: 1; border-radius: 8px; border: 3px solid transparent; cursor: pointer; position: relative; transition: transform 0.1s; }
        .color-btn:hover { transform: scale(1.1); }
        .color-btn.selected { border-color: var(--color-text); box-shadow: 0 0 0 2px white, 0 0 0 4px var(--color-text); }
        .color-btn.selected::after { content: '‚úì'; position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.8); }
        
        /* Fabric/Material Cards */
        .cards-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 10px; }
        .card { background: white; border: 2px solid var(--color-border); border-radius: 8px; padding: 12px; cursor: pointer; position: relative; }
        .card:hover { background: var(--color-background); }
        .card.selected { border-color: var(--color-primary); background: var(--color-primary); }
        .card.selected .card-name { color: white !important; }
        .card.selected .card-desc { color: rgba(255,255,255,0.9) !important; }
        .card.priority-1 { grid-column: span 2; background: linear-gradient(135deg, #eff6ff, #dbeafe); border: 2px dashed var(--color-primary); }
        .card.priority-1.selected { border-style: solid; background: var(--color-primary); }
        .card.dimmed { opacity: 0.3; pointer-events: none; }
        .card-name { font-size: 13px; font-weight: 700; color: var(--color-text); }
        .card-desc { font-size: 10px; color: var(--color-text-muted); margin-top: 2px; }
        .card-help { position: absolute; top: 6px; right: 6px; width: 18px; height: 18px; border-radius: 50%; background: rgba(59,130,246,0.1); color: var(--color-primary); font-size: 10px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .card.selected .card-help { background: rgba(255,255,255,0.2); color: white; }
        
        /* Help panel */
        .help-btn { width: 100%; padding: 10px; background: #fef3c7; border: 2px dashed #f59e0b; border-radius: 8px; font-size: 12px; font-weight: 600; color: #92400e; cursor: pointer; }
        .help-panel { background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; margin-top: 10px; }
        .help-panel.hidden { display: none; }
        .filter-row { display: flex; gap: 6px; margin-bottom: 8px; }
        .filter-btn { flex: 1; padding: 8px; font-size: 10px; font-weight: 700; text-transform: uppercase; background: white; border: 1px solid var(--color-border); border-radius: 6px; color: var(--color-text-muted); cursor: pointer; }
        .filter-btn.active { background: var(--color-primary); border-color: var(--color-primary); color: white; }
        .help-text { background: #fef3c7; border-radius: 6px; padding: 8px 10px; font-size: 11px; color: #92400e; margin-top: 8px; }
        .help-text.hidden { display: none; }
        
        .tag-warning { background: #fef2f2; border: 2px solid #fca5a5; border-radius: 8px; padding: 10px; font-size: 11px; font-weight: 600; color: #b91c1c; text-align: center; margin-bottom: 10px; }
        .tag-warning.hidden { display: none; }
        
        /* Navigation buttons */
        .nav-buttons { display: flex; gap: 12px; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--color-border); }
        .nav-btn { flex: 1; padding: 14px; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; border: none; }
        .nav-btn-back { background: white; color: var(--color-text); border: 2px solid var(--color-border); }
        .nav-btn-next { background: var(--color-primary); color: white; flex: 2; }
        .nav-btn-next:hover { background: var(--color-primary-dark); }
        
        /* Camera styles */
        .camera-header { background: #111; padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .camera-select { background: #222; border: 1px solid #444; color: white; padding: 8px 12px; border-radius: 6px; font-size: 12px; min-width: 200px; }
        .camera-status { font-size: 11px; font-weight: 700; color: #555; }
        .camera-status.live { color: #22c55e; }
        .camera-status.live::before { content: '‚óè'; margin-right: 6px; animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }
        .camera-view { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .camera-view video { max-width: 100%; max-height: 100%; object-fit: contain; }
        .camera-placeholder { color: #444; text-align: center; }
        .camera-placeholder-icon { font-size: 48px; margin-bottom: 12px; }
        .camera-overlay { position: absolute; inset: 0; pointer-events: none; display: none; }
        .camera-grid { position: absolute; inset: 10%; border: 2px dashed rgba(255,255,255,0.3); }
        .camera-footer { background: #111; padding: 16px; display: flex; justify-content: center; align-items: center; gap: 16px; border-top: 1px solid #333; }
        .shutter-btn { width: 70px; height: 70px; border-radius: 50%; background: white; border: 4px solid #333; cursor: pointer; }
        .shutter-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(255,255,255,0.3); }
        .shutter-btn:active { transform: scale(0.95); background: #ddd; }
        .shutter-btn.flash { animation: flash 0.15s; }
        @keyframes flash { 0%{background:white} 50%{background:var(--color-primary)} 100%{background:white} }
        .shutter-hint { color: #555; font-size: 11px; text-align: center; }
        .shutter-hint kbd { background: #333; padding: 3px 6px; border-radius: 4px; font-family: monospace; color: #aaa; }
        .mode-btn { padding: 10px 16px; background: #222; border: 2px solid #333; color: #666; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; }
        .mode-btn.active { background: var(--color-primary); border-color: var(--color-primary); color: white; }
        
        /* Photos panel */
        .photos-header { font-size: 13px; font-weight: 700; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        .photo-count { background: var(--color-primary-light); color: var(--color-primary-dark); padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; }
        .photo-section { margin-bottom: 16px; }
        .photo-section-title { font-size: 10px; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .photo-thumb { aspect-ratio: 1; border-radius: 6px; overflow: hidden; background: white; border: 2px solid var(--color-border); position: relative; }
        .photo-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .photo-thumb-delete { position: absolute; top: 2px; right: 2px; width: 18px; height: 18px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 11px; display: flex; align-items: center; justify-content: center; opacity: 0; }
        .photo-thumb:hover .photo-thumb-delete { opacity: 1; }
        .photo-thumb-empty { display: flex; align-items: center; justify-content: center; color: var(--color-border); font-size: 18px; cursor: pointer; }
        .stats-section { margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--color-border); }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; text-align: center; }
        .stat-value { font-size: 20px; font-weight: 800; }
        .stat-label { font-size: 9px; color: var(--color-text-muted); text-transform: uppercase; }
        
        .reset-btn { padding: 6px 12px; background: var(--color-error); color: white; border: none; border-radius: 6px; font-size: 11px; font-weight: 600; cursor: pointer; }
        .submit-btn { width: 100%; padding: 16px; background: var(--color-success); color: white; border: none; border-radius: 10px; font-size: 15px; font-weight: 700; cursor: pointer; }
        .submit-btn:disabled { background: var(--color-border); cursor: not-allowed; }
        
        .flash-overlay { position: fixed; inset: 0; background: white; z-index: 1000; opacity: 0; pointer-events: none; }
        .flash-overlay.flash { opacity: 1; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="flash-overlay" id="flash-overlay"></div>
    <div class="desktop-layout">
        <!-- LEFT: Form Panel with Steps -->
        <div class="form-panel">
            <!-- Floating Timer -->
            <div class="floating-timer">
                <div>
                    <div class="timer-label">CURRENT ITEM</div>
                    <div class="timer-main" id="timer-current">0:00</div>
                </div>
                <div class="timer-stats">
                    <div>Avg: <strong id="timer-avg">--</strong></div>
                    <div>Last: <strong id="timer-last">--</strong></div>
                </div>
                <button class="reset-btn" onclick="resetForm()">‚Üª Reset</button>
            </div>
            
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-dot active" id="dot-1" onclick="goToStep(1)"></div>
                <div class="progress-dot" id="dot-2" onclick="goToStep(2)"></div>
                <div class="progress-dot" id="dot-3" onclick="goToStep(3)"></div>
                <span class="progress-label" id="step-label">Step 1: Tag</span>
            </div>
            
            <!-- Step Content Area -->
            <div class="step-area">
                <!-- STEP 1: TAG -->
                <div id="step-1" class="step-container active">
                    <!-- Category -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-category" class="check-circle">‚óã</span> What is it?</div>
                        <div class="btn-grid btn-grid-3" style="margin-bottom:12px;">
                            <button onclick="setSuperCategory('tops', this)" class="btn btn-hero super-btn selected"><span class="emoji">üëï</span>TOPS</button>
                            <button onclick="setSuperCategory('bottoms', this)" class="btn btn-secondary super-btn"><span class="emoji">üëñ</span>BOTTOMS</button>
                            <button onclick="setSuperCategory('outer', this)" class="btn btn-secondary super-btn"><span class="emoji">üß•</span>OUTER</button>
                        </div>
                        <div id="sub-categories"></div>
                    </div>
                    
                    <!-- Tag Info -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-tag" class="check-circle">‚óã</span> Tag Info</div>
                        <button onclick="setTagStatus('has', this)" class="btn btn-default tag-btn" style="width:100%;margin-bottom:8px;">‚úì TAG READABLE</button>
                        <div class="btn-grid btn-grid-2">
                            <button onclick="setTagStatus('worn', this)" class="btn btn-tertiary tag-btn">üëÄ Worn/Faded</button>
                            <button onclick="setTagStatus('none', this)" class="btn btn-tertiary tag-btn">‚úÇÔ∏è Missing/Cut</button>
                        </div>
                        
                        <div id="tag-details" class="hidden nested-section">
                            <div class="sub-label">Tag Size</div>
                            <div class="btn-grid btn-grid-4" style="margin-bottom:8px;">
                                <button onclick="setSize('XS', this)" class="btn btn-tertiary size-btn">XS</button>
                                <button onclick="setSize('S', this)" class="btn btn-tertiary size-btn">S</button>
                                <button onclick="setSize('M', this)" class="btn btn-tertiary size-btn">M</button>
                                <button onclick="setSize('L', this)" class="btn btn-tertiary size-btn">L</button>
                                <button onclick="setSize('XL', this)" class="btn btn-tertiary size-btn">XL</button>
                                <button onclick="setSize('2XL', this)" class="btn btn-tertiary size-btn">2XL</button>
                                <button onclick="setSize('3XL', this)" class="btn btn-tertiary size-btn">3XL</button>
                                <button onclick="setSize('4XL', this)" class="btn btn-tertiary size-btn">4XL</button>
                            </div>
                            
                            <div class="sub-label">Origin</div>
                            <div class="btn-grid btn-grid-2" style="margin-bottom:8px;">
                                <button onclick="setOrigin('usa', this)" class="btn btn-default origin-btn">üá∫üá∏ USA Made</button>
                                <button onclick="setOrigin('import', this)" class="btn btn-tertiary origin-btn">üåç Import</button>
                            </div>
                            <div id="country-section" class="hidden">
                                <div class="btn-grid btn-grid-3">
                                    <button onclick="setCountry('China', this)" class="btn btn-tertiary country-btn">üá®üá≥ China</button>
                                    <button onclick="setCountry('Vietnam', this)" class="btn btn-tertiary country-btn">üáªüá≥ Vietnam</button>
                                    <button onclick="setCountry('Bangladesh', this)" class="btn btn-tertiary country-btn">üáßüá© Bangladesh</button>
                                    <button onclick="setCountry('Mexico', this)" class="btn btn-tertiary country-btn">üá≤üáΩ Mexico</button>
                                    <button onclick="setCountry('Honduras', this)" class="btn btn-tertiary country-btn">üá≠üá≥ Honduras</button>
                                    <button onclick="setCountry('Other', this)" class="btn btn-tertiary country-btn">üåç Other</button>
                                </div>
                            </div>
                            
                            <div class="sub-label">Gender on Tag</div>
                            <div class="btn-grid btn-grid-4">
                                <button onclick="setGender('Men', this)" class="btn btn-tertiary gender-btn">Men's</button>
                                <button onclick="setGender('Women', this)" class="btn btn-tertiary gender-btn">Women's</button>
                                <button onclick="setGender('Unisex', this)" class="btn btn-tertiary gender-btn">Unisex</button>
                                <button onclick="setGender('None', this)" class="btn btn-tertiary gender-btn">None</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button onclick="goToStep(2)" class="nav-btn nav-btn-next">Next: Check ‚Üí</button>
                    </div>
                </div>
                
                <!-- STEP 2: CHECK -->
                <div id="step-2" class="step-container">
                    <!-- Color -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-color" class="check-circle">‚óã</span> Color(s)</div>
                        <div class="color-grid">
                            <button onclick="toggleColor('Black', this)" class="color-btn" style="background:#000" title="Black"></button>
                            <button onclick="toggleColor('White', this)" class="color-btn" style="background:#FFF;border:1px solid #ddd" title="White"></button>
                            <button onclick="toggleColor('Gray', this)" class="color-btn" style="background:#808080" title="Gray"></button>
                            <button onclick="toggleColor('Navy', this)" class="color-btn" style="background:#000080" title="Navy"></button>
                            <button onclick="toggleColor('Blue', this)" class="color-btn" style="background:#0066FF" title="Blue"></button>
                            <button onclick="toggleColor('Red', this)" class="color-btn" style="background:#FF0000" title="Red"></button>
                            <button onclick="toggleColor('Green', this)" class="color-btn" style="background:#008000" title="Green"></button>
                            <button onclick="toggleColor('Yellow', this)" class="color-btn" style="background:#FFD700" title="Yellow"></button>
                            <button onclick="toggleColor('Orange', this)" class="color-btn" style="background:#FF8C00" title="Orange"></button>
                            <button onclick="toggleColor('Purple', this)" class="color-btn" style="background:#800080" title="Purple"></button>
                            <button onclick="toggleColor('Pink', this)" class="color-btn" style="background:#FF69B4" title="Pink"></button>
                            <button onclick="toggleColor('Brown', this)" class="color-btn" style="background:#8B4513" title="Brown"></button>
                            <button onclick="toggleColor('Tan', this)" class="color-btn" style="background:#D2B48C" title="Tan"></button>
                            <button onclick="toggleColor('Cream', this)" class="color-btn" style="background:#FFFDD0;border:1px solid #ddd" title="Cream"></button>
                            <button onclick="toggleColor('Multi', this)" class="color-btn" style="background:conic-gradient(red,orange,yellow,green,blue,purple,red)" title="Multi"></button>
                        </div>
                    </div>
                    
                    <!-- Pattern -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-pattern" class="check-circle">‚óã</span> Pattern</div>
                        <div class="btn-grid btn-grid-3">
                            <button onclick="setPattern('Solid', this)" class="btn btn-default pattern-btn">Solid</button>
                            <button onclick="setPattern('Striped', this)" class="btn btn-tertiary pattern-btn">Striped</button>
                            <button onclick="setPattern('Graphic', this)" class="btn btn-tertiary pattern-btn">Graphic</button>
                            <button onclick="setPattern('Plaid', this)" class="btn btn-tertiary pattern-btn">Plaid</button>
                            <button onclick="setPattern('Logo', this)" class="btn btn-tertiary pattern-btn">Logo</button>
                            <button onclick="setPattern('Other', this)" class="btn btn-tertiary pattern-btn">Other</button>
                        </div>
                    </div>
                    
                    <!-- Fabric Type -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-fabric-type" class="check-circle">‚óã</span> Fabric Type</div>
                        <div id="fabric-cards-grid" class="cards-grid"></div>
                        <button id="fabric-help-btn" onclick="toggleFabricHelp()" class="help-btn">ü§î Not Sure?</button>
                        <div id="fabric-help-panel" class="help-panel hidden">
                            <div class="sub-label" style="color:#92400e;">How does it feel?</div>
                            <div class="filter-row">
                                <button onclick="toggleFabricFilter('stretch','none',this)" class="filter-btn fabric-filter">Rigid</button>
                                <button onclick="toggleFabricFilter('stretch','high',this)" class="filter-btn fabric-filter">Stretchy</button>
                            </div>
                            <div class="sub-label" style="color:#92400e;">Surface?</div>
                            <div class="filter-row">
                                <button onclick="toggleFabricFilter('structure','smooth',this)" class="filter-btn fabric-filter">Smooth</button>
                                <button onclick="toggleFabricFilter('structure','diagonal',this)" class="filter-btn fabric-filter">Diagonal</button>
                                <button onclick="toggleFabricFilter('structure','ribs',this)" class="filter-btn fabric-filter">Ribs</button>
                            </div>
                            <div class="sub-label" style="color:#92400e;">Inside?</div>
                            <div class="filter-row">
                                <button onclick="toggleFabricFilter('interior','smooth',this)" class="filter-btn fabric-filter">Smooth</button>
                                <button onclick="toggleFabricFilter('interior','fuzzy',this)" class="filter-btn fabric-filter">Fuzzy</button>
                                <button onclick="toggleFabricFilter('interior','loops',this)" class="filter-btn fabric-filter">Loops</button>
                            </div>
                            <div id="fabric-helper" class="help-text hidden"></div>
                        </div>
                    </div>
                    
                    <!-- Material -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-material" class="check-circle">‚óã</span> Material</div>
                        <div id="material-tag-warning" class="tag-warning hidden">‚ö†Ô∏è No readable tag ‚Äî use touch tests</div>
                        <div id="material-cards-grid" class="cards-grid"></div>
                        <button id="material-help-btn" onclick="toggleMaterialHelp()" class="help-btn">ü§î Not Sure?</button>
                        <div id="material-help-panel" class="help-panel hidden">
                            <div class="sub-label" style="color:#92400e;">Temperature?</div>
                            <div class="filter-row">
                                <button onclick="toggleMaterialFilter('temp','cool',this)" class="filter-btn material-filter">Cool</button>
                                <button onclick="toggleMaterialFilter('temp','warm',this)" class="filter-btn material-filter">Warm</button>
                            </div>
                            <div class="sub-label" style="color:#92400e;">Shine?</div>
                            <div class="filter-row">
                                <button onclick="toggleMaterialFilter('shine','matte',this)" class="filter-btn material-filter">Matte</button>
                                <button onclick="toggleMaterialFilter('shine','sheen',this)" class="filter-btn material-filter">Sheen</button>
                            </div>
                            <div class="sub-label" style="color:#92400e;">Feel?</div>
                            <div class="filter-row">
                                <button onclick="toggleMaterialFilter('feel','soft',this)" class="filter-btn material-filter">Soft</button>
                                <button onclick="toggleMaterialFilter('feel','crisp',this)" class="filter-btn material-filter">Crisp</button>
                                <button onclick="toggleMaterialFilter('feel','slick',this)" class="filter-btn material-filter">Slick</button>
                            </div>
                            <div id="material-helper" class="help-text hidden"></div>
                        </div>
                    </div>
                    
                    <!-- Construction -->
                    <div class="section-card" id="construction-section">
                        <div class="section-label"><span id="check-construction" class="check-circle">‚óã</span> Construction</div>
                        <div class="sub-label">Sleeve Length</div>
                        <div class="btn-grid btn-grid-4" style="margin-bottom:10px;">
                            <button onclick="setSleeve('Short', this)" class="btn btn-default sleeve-btn">Short</button>
                            <button onclick="setSleeve('Long', this)" class="btn btn-tertiary sleeve-btn">Long</button>
                            <button onclick="setSleeve('3/4', this)" class="btn btn-tertiary sleeve-btn">3/4</button>
                            <button onclick="setSleeve('None', this)" class="btn btn-tertiary sleeve-btn">None</button>
                        </div>
                        <div id="sleeve-style-section">
                            <div class="sub-label">Sleeve Style</div>
                            <div class="btn-grid btn-grid-3" style="margin-bottom:10px;">
                                <button onclick="setSleeveStyle('Standard', this)" class="btn btn-default style-btn">Standard</button>
                                <button onclick="setSleeveStyle('Raglan', this)" class="btn btn-tertiary style-btn">Raglan</button>
                                <button onclick="setSleeveStyle('Dolman', this)" class="btn btn-tertiary style-btn">Dolman</button>
                            </div>
                        </div>
                        <div id="stitch-section">
                            <div class="sub-label">Stitch Type</div>
                            <div class="btn-grid btn-grid-2">
                                <button onclick="setStitch('Single', this)" class="btn btn-tertiary stitch-btn">Single Stitch</button>
                                <button onclick="setStitch('Double', this)" class="btn btn-default stitch-btn">Double Stitch</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Feel -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-feel" class="check-circle">‚óã</span> Feel</div>
                        <div class="sub-label">Thickness</div>
                        <div class="btn-grid btn-grid-4" style="margin-bottom:10px;">
                            <button onclick="setThickness('Paper', this)" class="btn btn-tertiary thickness-btn">Paper</button>
                            <button onclick="setThickness('Light', this)" class="btn btn-tertiary thickness-btn">Light</button>
                            <button onclick="setThickness('Standard', this)" class="btn btn-default thickness-btn">Standard</button>
                            <button onclick="setThickness('Heavy', this)" class="btn btn-tertiary thickness-btn">Heavy</button>
                        </div>
                        <div class="sub-label">Layers</div>
                        <div class="btn-grid btn-grid-3">
                            <button onclick="setLayers('Single', this)" class="btn btn-default layers-btn">Single</button>
                            <button onclick="setLayers('Reversible', this)" class="btn btn-tertiary layers-btn">Reversible</button>
                            <button onclick="setLayers('Lined', this)" class="btn btn-tertiary layers-btn">Lined</button>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button onclick="goToStep(1)" class="nav-btn nav-btn-back">‚Üê Back</button>
                        <button onclick="goToStep(3)" class="nav-btn nav-btn-next">Next: Snap ‚Üí</button>
                    </div>
                </div>
                
                <!-- STEP 3: SNAP & SEND -->
                <div id="step-3" class="step-container">
                    <!-- Condition -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-condition" class="check-circle">‚óã</span> Condition</div>
                        <div class="btn-grid btn-grid-2">
                            <button onclick="setDefects(false, this)" class="btn btn-default defect-btn">‚úì No Defects</button>
                            <button onclick="setDefects(true, this)" class="btn btn-tertiary defect-btn">‚ö†Ô∏è Has Defects</button>
                        </div>
                        <div id="defects-detail" class="hidden nested-section" style="margin-top:10px;">
                            <div class="sub-label">Defect Types</div>
                            <div class="btn-grid btn-grid-3">
                                <button onclick="toggleDefect('Stain', this)" class="btn btn-tertiary defect-type-btn">Stain</button>
                                <button onclick="toggleDefect('Hole', this)" class="btn btn-tertiary defect-type-btn">Hole</button>
                                <button onclick="toggleDefect('Tear', this)" class="btn btn-tertiary defect-type-btn">Tear</button>
                                <button onclick="toggleDefect('Fade', this)" class="btn btn-tertiary defect-type-btn">Fade</button>
                                <button onclick="toggleDefect('Pilling', this)" class="btn btn-tertiary defect-type-btn">Pilling</button>
                                <button onclick="toggleDefect('Other', this)" class="btn btn-tertiary defect-type-btn">Other</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SKU -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-sku" class="check-circle">‚óã</span> SKU</div>
                        <input type="text" id="sku-input" class="form-input" placeholder="Scan or type SKU..." oninput="data.sku=this.value.trim();updateValidation()">
                    </div>
                    
                    <div class="nav-buttons">
                        <button onclick="goToStep(2)" class="nav-btn nav-btn-back">‚Üê Back</button>
                        <button id="submit-btn" class="submit-btn" onclick="submitItem()" disabled style="flex:2;">‚úì Submit Item</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CENTER: Camera -->
        <div class="camera-panel">
            <div class="camera-header">
                <select id="camera-select" class="camera-select" onchange="switchCamera(this.value)"><option value="">Select Camera...</option></select>
                <div id="camera-status" class="camera-status">No camera</div>
            </div>
            <div class="camera-view">
                <div class="camera-placeholder" id="camera-placeholder">
                    <div class="camera-placeholder-icon">üì∑</div>
                    <div>Select a camera to begin</div>
                    <div style="font-size:11px;margin-top:6px;color:#555;">Logitech Brio 4K recommended</div>
                </div>
                <video id="camera-video" autoplay playsinline style="display:none;"></video>
                <div class="camera-overlay" id="camera-overlay"><div class="camera-grid"></div></div>
            </div>
            <div class="camera-footer">
                <button class="mode-btn active" id="mode-main" onclick="setPhotoMode('main')">üì¶ Main</button>
                <div style="text-align:center;">
                    <button class="shutter-btn" id="shutter-btn" onclick="capturePhoto()"></button>
                    <div class="shutter-hint">Press <kbd>SPACE</kbd> or foot pedal</div>
                </div>
                <button class="mode-btn" id="mode-tag" onclick="setPhotoMode('tag')">üè∑Ô∏è Tag</button>
                <button class="mode-btn" id="mode-defect" onclick="setPhotoMode('defect')">‚ö†Ô∏è Defects</button>
            </div>
        </div>
        
        <!-- RIGHT: Photos -->
        <div class="photos-panel">
            <div class="photos-header"><span>Photos</span><span class="photo-count" id="photo-count">0</span></div>
            <div class="photo-section">
                <div class="photo-section-title"><span>Main Photos</span><span id="main-count">0</span></div>
                <div class="photo-grid" id="main-photos-grid"><div class="photo-thumb photo-thumb-empty" onclick="setPhotoMode('main')">+</div></div>
            </div>
            <div class="photo-section">
                <div class="photo-section-title"><span>Tag Photos</span><span id="tag-count">0</span></div>
                <div class="photo-grid" id="tag-photos-grid"><div class="photo-thumb photo-thumb-empty" onclick="setPhotoMode('tag')">+</div></div>
            </div>
            <div class="photo-section">
                <div class="photo-section-title"><span>Defect Photos</span><span id="defect-count">0</span></div>
                <div class="photo-grid" id="defect-photos-grid"><div class="photo-thumb photo-thumb-empty" onclick="setPhotoMode('defect')">+</div></div>
            </div>
            <div class="stats-section">
                <div style="font-size:10px;color:var(--color-text-muted);font-weight:700;margin-bottom:8px;">Today's Stats</div>
                <div class="stats-grid">
                    <div><div class="stat-value" style="color:var(--color-primary)" id="stat-today">0</div><div class="stat-label">Today</div></div>
                    <div><div class="stat-value" style="color:var(--color-success)" id="stat-week">0</div><div class="stat-label">Week</div></div>
                    <div><div class="stat-value" id="stat-total">0</div><div class="stat-label">Total</div></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let data = { superCategory:'tops', category:'', tagStatus:'', tagSize:'', origin:'', country:'', gender:'', colors:[], pattern:'', fabricType:'', material:'', sleeveLength:'', sleeveStyle:'', stitch:'', thickness:'', layers:'', hasDefects:null, defectTypes:[], sku:'', mainPhotos:[], tagPhotos:[], defectPhotos:[] };
        let stats = { today:0, week:0, total:0 }, currentStep = 1, photoMode = 'main', currentStream = null;
        let fabricFilters = { stretch:null, structure:null, interior:null }, materialFilters = { temp:null, shine:null, feel:null };
        let timerStart = null, timerInterval = null, itemTimes = [];

        const categoryConfig = {
            tops: { heroes: ['T-Shirt', 'Sweatshirt', 'Hoodie'], others: ['Sweater', 'Button Shirt', 'Polo', 'Jersey', 'Tank Top', 'Cardigan', 'Blouse', 'Tunic'] },
            bottoms: { heroes: ['Jeans', 'Pants'], others: ['Shorts', 'Sweatpants'] },
            outer: { heroes: ['Jacket', 'Coat'], others: ['Vest'] }
        };
        const catEmojis = { 'T-Shirt':'üëï', 'Sweatshirt':'üèãÔ∏è', 'Hoodie':'üß•', 'Sweater':'üß∂', 'Button Shirt':'üëî', 'Polo':'üèåÔ∏è', 'Jersey':'üèÄ', 'Tank Top':'ü©±', 'Cardigan':'üß•', 'Jeans':'üëñ', 'Pants':'üëñ', 'Shorts':'ü©≥', 'Sweatpants':'üèÉ', 'Jacket':'üß•', 'Coat':'üß•', 'Vest':'ü¶∫', 'Blouse':'üëö', 'Tunic':'üëó' };
        
        const fabricDB = {
            "T-Shirt": [{ name:"Knit", priority:1, default:true, traits:{stretch:"high",structure:"smooth",interior:"smooth"}, desc:"Standard tee. Soft & stretchy." },{ name:"Jersey", priority:2, traits:{stretch:"high",structure:"smooth",interior:"smooth"}, desc:"Same as knit. eBay term." },{ name:"Mesh", priority:3, traits:{stretch:"high",structure:"rough",interior:"smooth"}, desc:"See-through athletic." }],
            "Sweatshirt": [{ name:"Fleece", priority:1, default:true, traits:{stretch:"high",structure:"smooth",interior:"fuzzy"}, desc:"Fuzzy inside. Most common." },{ name:"French Terry", priority:2, traits:{stretch:"high",structure:"smooth",interior:"loops"}, desc:"Loops inside. Lighter." }],
            "Hoodie": [{ name:"Fleece", priority:1, default:true, traits:{stretch:"high",structure:"smooth",interior:"fuzzy"}, desc:"Fuzzy inside. Standard." },{ name:"French Terry", priority:2, traits:{stretch:"high",structure:"smooth",interior:"loops"}, desc:"Loops inside. Lighter." }],
            "Button Shirt": [{ name:"Woven", priority:1, default:true, traits:{stretch:"none",structure:"smooth",interior:"smooth"}, desc:"Standard dress shirt." },{ name:"Flannel", priority:1, traits:{stretch:"none",structure:"smooth",interior:"fuzzy"}, desc:"Soft, brushed." },{ name:"Denim", priority:2, traits:{stretch:"none",structure:"diagonal",interior:"smooth"}, desc:"Western shirt." }],
            "Polo": [{ name:"Pique", priority:1, default:true, traits:{stretch:"high",structure:"rough",interior:"smooth"}, desc:"Classic polo texture." },{ name:"Knit", priority:2, traits:{stretch:"high",structure:"smooth",interior:"smooth"}, desc:"Smooth polo." }],
            "Sweater": [{ name:"Knit", priority:1, default:true, traits:{stretch:"high",structure:"ribs",interior:"smooth"}, desc:"Standard sweater." },{ name:"Fleece", priority:2, traits:{stretch:"high",structure:"smooth",interior:"fuzzy"}, desc:"Patagonia style." }],
            "Jacket": [{ name:"Nylon", priority:1, default:true, traits:{stretch:"none",structure:"smooth",interior:"smooth"}, desc:"Windbreaker." },{ name:"Denim", priority:1, traits:{stretch:"none",structure:"diagonal",interior:"smooth"}, desc:"Jean jacket." },{ name:"Canvas", priority:2, traits:{stretch:"none",structure:"rough",interior:"smooth"}, desc:"Work jacket." },{ name:"Leather", priority:2, traits:{stretch:"none",structure:"smooth",interior:"smooth"}, desc:"Moto, bomber." }],
            "Coat": [{ name:"Wool", priority:1, default:true, traits:{stretch:"none",structure:"smooth",interior:"smooth"}, desc:"Dress coat." },{ name:"Down", priority:2, traits:{stretch:"none",structure:"smooth",interior:"smooth"}, desc:"Puffer coat." }],
            "Jeans": [{ name:"Denim", priority:1, default:true, traits:{stretch:"none",structure:"diagonal",interior:"smooth"}, desc:"Standard jean." },{ name:"Selvage", priority:2, traits:{stretch:"none",structure:"diagonal",interior:"smooth"}, desc:"Premium. Red line." }],
            "Pants": [{ name:"Twill", priority:1, default:true, traits:{stretch:"none",structure:"diagonal",interior:"smooth"}, desc:"Chinos, khakis." },{ name:"Corduroy", priority:2, traits:{stretch:"none",structure:"ribs",interior:"smooth"}, desc:"Vertical ridges." }],
            "Shorts": [{ name:"Twill", priority:1, default:true, traits:{stretch:"none",structure:"diagonal",interior:"smooth"}, desc:"Chino shorts." },{ name:"Denim", priority:2, traits:{stretch:"none",structure:"diagonal",interior:"smooth"}, desc:"Jean shorts." }],
            "default": [{ name:"Knit", priority:1, default:true, traits:{stretch:"high",structure:"smooth",interior:"smooth"}, desc:"Standard fabric." }]
        };
        const materialDB = {
            "T-Shirt": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte",feel:"soft"}, desc:"Natural. Cool, soft." },{ name:"50/50 Blend", priority:1, traits:{temp:"cool",shine:"matte",feel:"soft"}, desc:"Cotton/Poly mix." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen",feel:"slick"}, desc:"Synthetic." },{ name:"Tri-Blend", priority:2, traits:{temp:"cool",shine:"matte",feel:"soft"}, desc:"Ultra soft." }],
            "Sweatshirt": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte",feel:"soft"}, desc:"Natural." },{ name:"Cotton/Poly", priority:1, traits:{temp:"cool",shine:"matte",feel:"soft"}, desc:"Common blend." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen",feel:"slick"}, desc:"Athletic." }],
            "Hoodie": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte",feel:"soft"}, desc:"Natural." },{ name:"Cotton/Poly", priority:1, traits:{temp:"cool",shine:"matte",feel:"soft"}, desc:"Common blend." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen",feel:"slick"}, desc:"Tech fleece." }],
            "Button Shirt": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte",feel:"crisp"}, desc:"Natural." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen",feel:"slick"}, desc:"Wrinkle-free." },{ name:"Linen", priority:2, traits:{temp:"cool",shine:"matte",feel:"crisp"}, desc:"Natural. Wrinkles." }],
            "Sweater": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte",feel:"soft"}, desc:"Lightweight." },{ name:"Wool", priority:1, traits:{temp:"warm",shine:"matte",feel:"soft"}, desc:"Warm." },{ name:"Acrylic", priority:2, traits:{temp:"warm",shine:"matte",feel:"soft"}, desc:"Synthetic wool." }],
            "Jacket": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte",feel:"crisp"}, desc:"Denim, canvas." },{ name:"Nylon", priority:1, traits:{temp:"warm",shine:"sheen",feel:"slick"}, desc:"Windbreaker." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen",feel:"slick"}, desc:"Athletic." },{ name:"Leather", priority:2, traits:{temp:"cool",shine:"sheen",feel:"soft"}, desc:"Real leather." }],
            "Jeans": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte",feel:"crisp"}, desc:"100% denim." },{ name:"Cotton/Spandex", priority:2, traits:{temp:"cool",shine:"matte",feel:"soft"}, desc:"Stretch jeans." }],
            "Pants": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte",feel:"crisp"}, desc:"Chinos." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen",feel:"slick"}, desc:"Dress pants." }],
            "default": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte",feel:"soft"}, desc:"Natural fiber." }]
        };

        document.addEventListener('DOMContentLoaded', () => { loadStats(); enumerateCameras(); renderSubCategories('tops'); renderFabricCards(); renderMaterialCards(); updateValidation(); startTimer(); document.addEventListener('keydown', (e) => { if (e.code === 'Space' && e.target.tagName !== 'INPUT') { e.preventDefault(); capturePhoto(); } }); });
        
        function goToStep(step) { currentStep = step; document.querySelectorAll('.step-container').forEach(s => s.classList.remove('active')); document.getElementById(`step-${step}`).classList.add('active'); document.querySelectorAll('.progress-dot').forEach((d,i) => { d.classList.remove('active'); if(i+1 < step) d.classList.add('complete'); else d.classList.remove('complete'); if(i+1 === step) d.classList.add('active'); }); const labels = {1:'Step 1: Tag', 2:'Step 2: Check', 3:'Step 3: Snap'}; document.getElementById('step-label').textContent = labels[step] || ''; }
        
        function startTimer() { timerStart = Date.now(); if (timerInterval) clearInterval(timerInterval); timerInterval = setInterval(updateTimerDisplay, 1000); updateTimerDisplay(); }
        function updateTimerDisplay() { if (!timerStart) return; const elapsed = Math.floor((Date.now() - timerStart) / 1000); document.getElementById('timer-current').textContent = `${Math.floor(elapsed/60)}:${(elapsed%60).toString().padStart(2,'0')}`; }
        function recordItemTime() { if (!timerStart) return; const elapsed = Math.floor((Date.now() - timerStart) / 1000); itemTimes.push(elapsed); document.getElementById('timer-last').textContent = `${Math.floor(elapsed/60)}:${(elapsed%60).toString().padStart(2,'0')}`; const avg = Math.floor(itemTimes.reduce((a,b)=>a+b,0)/itemTimes.length); document.getElementById('timer-avg').textContent = `${Math.floor(avg/60)}:${(avg%60).toString().padStart(2,'0')}`; startTimer(); }
        
        async function enumerateCameras() { try { await navigator.mediaDevices.getUserMedia({video:true}); const devices = await navigator.mediaDevices.enumerateDevices(); const videoDevices = devices.filter(d=>d.kind==='videoinput'); const select = document.getElementById('camera-select'); select.innerHTML = '<option value="">Select Camera...</option>'; videoDevices.forEach((device,i)=>{ const option = document.createElement('option'); option.value = device.deviceId; option.textContent = device.label || `Camera ${i+1}`; if(device.label.toLowerCase().includes('brio')){ option.selected = true; switchCamera(device.deviceId); } select.appendChild(option); }); } catch(err){ console.error('Camera error:', err); } }
        async function switchCamera(deviceId) { if(!deviceId)return; if(currentStream)currentStream.getTracks().forEach(t=>t.stop()); try{ currentStream = await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:deviceId},width:{ideal:3840},height:{ideal:2160},frameRate:{ideal:30}}}); const video = document.getElementById('camera-video'); video.srcObject = currentStream; video.style.display = 'block'; document.getElementById('camera-placeholder').style.display = 'none'; document.getElementById('camera-overlay').style.display = 'block'; document.getElementById('camera-status').textContent = 'LIVE'; document.getElementById('camera-status').classList.add('live'); }catch(err){ console.error('Camera error:',err); } }
        function setPhotoMode(mode) { photoMode = mode; document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active')); document.getElementById(`mode-${mode}`).classList.add('active'); }
        function capturePhoto() { const video = document.getElementById('camera-video'); if(!video.srcObject)return; document.getElementById('flash-overlay').classList.add('flash'); setTimeout(()=>document.getElementById('flash-overlay').classList.remove('flash'),100); const canvas = document.createElement('canvas'); canvas.width = video.videoWidth; canvas.height = video.videoHeight; canvas.getContext('2d').drawImage(video,0,0); const maxSize = photoMode==='tag'?1600:1400; if(canvas.width>maxSize||canvas.height>maxSize){ const scale = maxSize/Math.max(canvas.width,canvas.height); const resized = document.createElement('canvas'); resized.width = canvas.width*scale; resized.height = canvas.height*scale; resized.getContext('2d').drawImage(canvas,0,0,resized.width,resized.height); canvas.width = resized.width; canvas.height = resized.height; canvas.getContext('2d').drawImage(resized,0,0); } canvas.toBlob(blob=>{ const photo = {blob,url:URL.createObjectURL(blob)}; if(photoMode==='main')data.mainPhotos.push(photo); else if(photoMode==='tag')data.tagPhotos.push(photo); else data.defectPhotos.push(photo); updatePhotoGrids(); updateValidation(); },'image/jpeg',0.88); }
        function updatePhotoGrids() { const renderGrid = (photos,gridId,mode) => { document.getElementById(gridId).innerHTML = photos.map((p,i)=>`<div class="photo-thumb"><img src="${p.url}"><button class="photo-thumb-delete" onclick="deletePhoto('${mode}',${i})">√ó</button></div>`).join('') + `<div class="photo-thumb photo-thumb-empty" onclick="setPhotoMode('${mode}')">+</div>`; }; renderGrid(data.mainPhotos,'main-photos-grid','main'); renderGrid(data.tagPhotos,'tag-photos-grid','tag'); renderGrid(data.defectPhotos,'defect-photos-grid','defect'); document.getElementById('main-count').textContent = data.mainPhotos.length; document.getElementById('tag-count').textContent = data.tagPhotos.length; document.getElementById('defect-count').textContent = data.defectPhotos.length; document.getElementById('photo-count').textContent = data.mainPhotos.length+data.tagPhotos.length+data.defectPhotos.length; }
        function deletePhoto(mode,index) { if(mode==='main'){URL.revokeObjectURL(data.mainPhotos[index].url);data.mainPhotos.splice(index,1);} else if(mode==='tag'){URL.revokeObjectURL(data.tagPhotos[index].url);data.tagPhotos.splice(index,1);} else{URL.revokeObjectURL(data.defectPhotos[index].url);data.defectPhotos.splice(index,1);} updatePhotoGrids(); updateValidation(); }
        
        function setSuperCategory(cat, btn) { data.superCategory = cat; data.category = ''; document.querySelectorAll('.super-btn').forEach(b => { b.classList.remove('selected','btn-hero'); b.classList.add('btn-secondary'); }); btn.classList.add('selected','btn-hero'); btn.classList.remove('btn-secondary'); renderSubCategories(cat); updateValidation(); }
        function renderSubCategories(superCat) { const config = categoryConfig[superCat]; const container = document.getElementById('sub-categories'); container.innerHTML = `<button onclick="setCategory('${config.heroes[0]}', this)" class="cat-hero cat-btn" style="width:100%;margin-bottom:8px;"><span style="font-size:20px;">${catEmojis[config.heroes[0]]||'üëï'}</span> ${config.heroes[0].toUpperCase()}</button><div class="btn-grid btn-grid-2" style="margin-bottom:8px;">${config.heroes.slice(1).map(c=>`<button onclick="setCategory('${c}', this)" class="cat-secondary cat-btn"><span>${catEmojis[c]||'üëï'}</span> ${c}</button>`).join('')}</div><div class="btn-grid btn-grid-4">${config.others.map(c=>`<button onclick="setCategory('${c}', this)" class="cat-other cat-btn">${c}</button>`).join('')}</div>`; }
        function setCategory(cat, btn) { data.category = cat; document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); renderFabricCards(); renderMaterialCards(); updateValidation(); }
        
        function setTagStatus(status, btn) { data.tagStatus = status; document.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); document.getElementById('tag-details').classList.toggle('hidden', status !== 'has'); document.getElementById('material-tag-warning').classList.toggle('hidden', status === 'has'); updateValidation(); }
        function setSize(size, btn) { data.tagSize = size; document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function setOrigin(origin, btn) { data.origin = origin; document.querySelectorAll('.origin-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); document.getElementById('country-section').classList.toggle('hidden', origin !== 'import'); if(origin==='usa')data.country='USA'; }
        function setCountry(country, btn) { data.country = country; document.querySelectorAll('.country-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function setGender(gender, btn) { data.gender = gender; document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function toggleColor(color, btn) { const idx = data.colors.indexOf(color); if(idx>-1){data.colors.splice(idx,1);btn.classList.remove('selected');} else{data.colors.push(color);btn.classList.add('selected');} updateValidation(); }
        function setPattern(pattern, btn) { data.pattern = pattern; document.querySelectorAll('.pattern-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); updateValidation(); }
        function setSleeve(length, btn) { data.sleeveLength = length; document.querySelectorAll('.sleeve-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); document.getElementById('sleeve-style-section').classList.toggle('hidden', length==='None'); updateValidation(); }
        function setSleeveStyle(style, btn) { data.sleeveStyle = style; document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function setStitch(stitch, btn) { data.stitch = stitch; document.querySelectorAll('.stitch-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function setThickness(thickness, btn) { data.thickness = thickness; document.querySelectorAll('.thickness-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); updateValidation(); }
        function setLayers(layers, btn) { data.layers = layers; document.querySelectorAll('.layers-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); updateValidation(); }
        function setDefects(hasDefects, btn) { data.hasDefects = hasDefects; document.querySelectorAll('.defect-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); document.getElementById('defects-detail').classList.toggle('hidden', !hasDefects); if(!hasDefects)data.defectTypes=[]; updateValidation(); }
        function toggleDefect(type, btn) { const idx = data.defectTypes.indexOf(type); if(idx>-1){data.defectTypes.splice(idx,1);btn.classList.remove('selected');} else{data.defectTypes.push(type);btn.classList.add('selected');} }
        
        function renderFabricCards() { const grid = document.getElementById('fabric-cards-grid'); const fabrics = fabricDB[data.category] || fabricDB['default']; grid.innerHTML = ''; fabrics.forEach(fab=>{ let dimmed = false; if(fabricFilters.stretch&&fab.traits.stretch!==fabricFilters.stretch)dimmed=true; if(fabricFilters.structure&&fab.traits.structure!==fabricFilters.structure)dimmed=true; if(fabricFilters.interior&&fab.traits.interior!==fabricFilters.interior)dimmed=true; const card = document.createElement('div'); card.className = `card ${fab.default?'priority-1':''} ${data.fabricType===fab.name?'selected':''} ${dimmed?'dimmed':''}`; card.innerHTML = `<button class="card-help" onclick="event.stopPropagation();">?</button><div class="card-name">${fab.name}</div><div class="card-desc">${fab.desc}</div>`; if(!dimmed)card.onclick = ()=>{ data.fabricType=fab.name; renderFabricCards(); updateValidation(); }; grid.appendChild(card); }); }
        function toggleFabricHelp() { const panel = document.getElementById('fabric-help-panel'); panel.classList.toggle('hidden'); }
        function toggleFabricFilter(type, value, btn) { if(fabricFilters[type]===value){fabricFilters[type]=null;btn.classList.remove('active');} else{fabricFilters[type]=value;btn.parentElement.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');} renderFabricCards(); const helper = document.getElementById('fabric-helper'); let advice = ''; if(fabricFilters.interior==='fuzzy')advice='üí° Fuzzy inside = Fleece'; else if(fabricFilters.interior==='loops')advice='üí° Loops inside = French Terry'; else if(fabricFilters.structure==='diagonal')advice='üí° Diagonal = Denim or Twill'; if(advice){helper.innerHTML=advice;helper.classList.remove('hidden');} else helper.classList.add('hidden'); }
        
        function renderMaterialCards() { const grid = document.getElementById('material-cards-grid'); const materials = materialDB[data.category] || materialDB['default']; grid.innerHTML = ''; materials.forEach(mat=>{ let dimmed = false; if(materialFilters.temp&&mat.traits.temp!==materialFilters.temp)dimmed=true; if(materialFilters.shine&&mat.traits.shine!==materialFilters.shine)dimmed=true; if(materialFilters.feel&&mat.traits.feel!==materialFilters.feel)dimmed=true; const card = document.createElement('div'); card.className = `card ${mat.default?'priority-1':''} ${data.material===mat.name?'selected':''} ${dimmed?'dimmed':''}`; card.innerHTML = `<button class="card-help" onclick="event.stopPropagation();">?</button><div class="card-name">${mat.name}</div><div class="card-desc">${mat.desc}</div>`; if(!dimmed)card.onclick = ()=>{ data.material=mat.name; renderMaterialCards(); updateValidation(); }; grid.appendChild(card); }); }
        function toggleMaterialHelp() { const panel = document.getElementById('material-help-panel'); panel.classList.toggle('hidden'); }
        function toggleMaterialFilter(type, value, btn) { if(materialFilters[type]===value){materialFilters[type]=null;btn.classList.remove('active');} else{materialFilters[type]=value;btn.parentElement.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');} renderMaterialCards(); const helper = document.getElementById('material-helper'); let advice = ''; if(materialFilters.temp==='cool'&&materialFilters.shine==='matte'&&materialFilters.feel==='soft')advice='üí° Almost certainly Cotton!'; else if(materialFilters.temp==='warm'&&materialFilters.shine==='sheen')advice='üí° Likely Polyester'; else if(materialFilters.temp==='cool')advice='üí° Cool = Cotton, Linen, Rayon'; if(advice){helper.innerHTML=advice;helper.classList.remove('hidden');} else helper.classList.add('hidden'); }
        
        function updateValidation() { const checks = { category:!!data.category, tag:!!data.tagStatus, color:data.colors.length>0, pattern:!!data.pattern, 'fabric-type':!!data.fabricType, material:!!data.material, construction:!!data.sleeveLength, feel:!!data.thickness&&!!data.layers, condition:data.hasDefects!==null, sku:!!data.sku }; Object.entries(checks).forEach(([key,ok])=>{ const el = document.getElementById(`check-${key}`); if(el){el.innerHTML=ok?'‚úì':'‚óã';el.classList.toggle('complete',ok);} }); const allRequired = checks.category&&checks.tag&&checks.color&&checks.pattern&&checks['fabric-type']&&checks.material&&checks.construction&&checks.feel&&checks.condition&&checks.sku; const hasPhotos = data.mainPhotos.length>0; document.getElementById('submit-btn').disabled = !(allRequired&&hasPhotos); }
        
        function submitItem() { recordItemTime(); stats.today++; stats.week++; stats.total++; saveStats(); updateStatsDisplay(); console.log('Submitted:',data); resetForm(); }
        function resetForm() { data.mainPhotos.forEach(p=>URL.revokeObjectURL(p.url)); data.tagPhotos.forEach(p=>URL.revokeObjectURL(p.url)); data.defectPhotos.forEach(p=>URL.revokeObjectURL(p.url)); data = {superCategory:'tops',category:'',tagStatus:'',tagSize:'',origin:'',country:'',gender:'',colors:[],pattern:'',fabricType:'',material:'',sleeveLength:'',sleeveStyle:'',stitch:'',thickness:'',layers:'',hasDefects:null,defectTypes:[],sku:'',mainPhotos:[],tagPhotos:[],defectPhotos:[]}; document.querySelectorAll('.selected').forEach(b=>b.classList.remove('selected')); document.querySelectorAll('.super-btn').forEach((b,i)=>{if(i===0){b.classList.add('selected','btn-hero');b.classList.remove('btn-secondary');}else{b.classList.remove('selected','btn-hero');b.classList.add('btn-secondary');}}); document.getElementById('sku-input').value=''; document.getElementById('tag-details').classList.add('hidden'); document.getElementById('country-section').classList.add('hidden'); document.getElementById('defects-detail').classList.add('hidden'); fabricFilters={stretch:null,structure:null,interior:null}; materialFilters={temp:null,shine:null,feel:null}; document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active')); renderSubCategories('tops'); renderFabricCards(); renderMaterialCards(); updatePhotoGrids(); updateValidation(); goToStep(1); }
        
        function loadStats() { try{ const saved = JSON.parse(localStorage.getItem('vl_stats_v98')||'{}'); if(saved.date!==new Date().toDateString()){saved.today=0;} stats = {today:saved.today||0,week:saved.week||0,total:saved.total||0}; itemTimes = saved.itemTimes||[]; updateStatsDisplay(); if(itemTimes.length>0){ const avg = Math.floor(itemTimes.reduce((a,b)=>a+b,0)/itemTimes.length); document.getElementById('timer-avg').textContent = `${Math.floor(avg/60)}:${(avg%60).toString().padStart(2,'0')}`; } }catch(e){} }
        function saveStats() { try{localStorage.setItem('vl_stats_v98',JSON.stringify({...stats,date:new Date().toDateString(),itemTimes:itemTimes.slice(-50)}));}catch(e){} }
        function updateStatsDisplay() { document.getElementById('stat-today').textContent = stats.today; document.getElementById('stat-week').textContent = stats.week; document.getElementById('stat-total').textContent = stats.total; }
    </script>
</body>
</html>

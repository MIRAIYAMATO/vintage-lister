<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VintageLister v98 - Desktop Station</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --color-primary: #3b82f6; --color-primary-dark: #2563eb; --color-primary-light: #dbeafe; --color-success: #22c55e; --color-warning: #f59e0b; --color-error: #ef4444; --color-surface: #ffffff; --color-background: #f1f5f9; --color-text: #1e293b; --color-text-muted: #64748b; --color-border: #e2e8f0; }
        * { box-sizing: border-box; }
        html, body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; margin: 0; padding: 0; height: 100vh; overflow: hidden; }
        
        /* PIN LOCK SCREEN */
        .pin-screen { position: fixed; inset: 0; z-index: 1000; background: linear-gradient(135deg, #1e293b, #0f172a); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .pin-screen.hidden { display: none; }
        .pin-box { background: white; border-radius: 20px; padding: 32px; width: 340px; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.3); }
        .pin-title { font-size: 24px; font-weight: 800; margin-bottom: 8px; }
        .pin-subtitle { color: var(--color-text-muted); font-size: 14px; margin-bottom: 20px; }
        .pin-input { width: 100%; padding: 16px; font-size: 32px; text-align: center; letter-spacing: 12px; border: 2px solid var(--color-border); border-radius: 12px; font-family: monospace; margin-bottom: 16px; }
        .pin-input:focus { outline: none; border-color: var(--color-primary); }
        .pin-input.shake { animation: shake 0.3s; border-color: var(--color-error); }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
        .photographer-select { width: 100%; padding: 12px; border: 2px solid var(--color-border); border-radius: 10px; font-size: 14px; margin-bottom: 20px; }
        .pin-btn { width: 100%; padding: 16px; background: var(--color-primary); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; }
        .pin-btn:hover { background: var(--color-primary-dark); }
        .pin-version { color: #475569; font-size: 12px; margin-top: 16px; }
        
        .desktop-layout { display: grid; grid-template-columns: 420px 1fr 280px; height: 100vh; }
        .form-panel { background: var(--color-surface); display: flex; flex-direction: column; overflow: hidden; }
        .camera-panel { background: #000; display: flex; flex-direction: column; }
        .photos-panel { background: var(--color-background); overflow-y: auto; padding: 16px; border-left: 1px solid var(--color-border); }
        
        /* FLOATING TIMER */
        .floating-timer { position: sticky; top: 0; z-index: 10; background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark)); color: white; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(59,130,246,0.3); }
        .timer-main { font-size: 28px; font-weight: 800; font-family: monospace; }
        .timer-stats { text-align: right; font-size: 11px; opacity: 0.9; }
        .timer-label { font-size: 10px; opacity: 0.7; }
        .photographer-badge { background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; cursor: pointer; }
        
        /* PROGRESS BAR */
        .progress-bar { display: flex; justify-content: center; align-items: center; gap: 8px; padding: 12px 16px; background: var(--color-background); border-bottom: 1px solid var(--color-border); flex-wrap: wrap; }
        .progress-dot { width: 12px; height: 12px; border-radius: 50%; background: var(--color-border); cursor: pointer; transition: all 0.2s; }
        .progress-dot.active { background: var(--color-primary); transform: scale(1.3); }
        .progress-dot.complete { background: var(--color-success); }
        .progress-label { font-size: 11px; color: var(--color-text-muted); font-weight: 600; margin-left: 8px; }
        .category-badge { font-size: 11px; color: var(--color-primary); font-weight: 700; text-transform: uppercase; margin-left: 4px; }
        .sku-badge { font-size: 10px; background: var(--color-success); color: white; font-weight: 700; padding: 2px 8px; border-radius: 10px; margin-left: 8px; font-family: monospace; display: none; }
        .sku-badge.visible { display: inline-block; }
        
        /* STEP CONTAINER */
        .step-area { flex: 1; overflow-y: auto; padding: 16px; }
        .step-container { display: none; }
        .step-container.active { display: block; }
        
        .section-card { background: var(--color-background); border: 1px solid var(--color-border); border-radius: 12px; padding: 14px; margin-bottom: 12px; }
        .section-label { font-size: 12px; font-weight: 700; color: var(--color-text); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        .check-circle { width: 20px; height: 20px; border-radius: 50%; background: var(--color-border); color: #999; display: flex; align-items: center; justify-content: center; font-size: 11px; }
        .check-circle.complete { background: var(--color-success); color: white; }
        
        .btn { padding: 10px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; border: 2px solid transparent; transition: all 0.1s; text-align: center; }
        .btn:active { transform: scale(0.97); }
        .btn-tertiary { background: white; color: var(--color-text-muted); border: 1px solid var(--color-border); }
        .btn-tertiary:hover { background: var(--color-background); }
        .btn-tertiary.selected { border: 2px solid var(--color-primary) !important; background: var(--color-primary) !important; color: white !important; }
        .btn-default { background: #e0f2fe; color: #0369a1; border: 2px dashed #7dd3fc; }
        .btn-default:hover { background: #bae6fd; }
        .btn-default.selected { border: 2px solid var(--color-primary) !important; background: var(--color-primary) !important; color: white !important; }
        .btn-hero { background: var(--color-primary); color: white; font-size: 14px; padding: 14px; }
        .btn-hero:hover { background: var(--color-primary-dark); }
        .btn-secondary { background: white; color: var(--color-text); border: 2px solid var(--color-border); }
        .btn-grid { display: grid; gap: 8px; }
        .btn-grid-2 { grid-template-columns: repeat(2, 1fr); }
        .btn-grid-3 { grid-template-columns: repeat(3, 1fr); }
        .btn-grid-4 { grid-template-columns: repeat(4, 1fr); }
        
        .form-input, .form-select { width: 100%; padding: 10px 12px; border: 2px solid var(--color-border); border-radius: 8px; font-size: 14px; }
        .form-input:focus, .form-select:focus { outline: none; border-color: var(--color-primary); }
        
        .sub-label { font-size: 11px; color: var(--color-text-muted); font-weight: 600; margin: 10px 0 8px 0; }
        .nested-section { background: rgba(59,130,246,0.05); border: 1px solid rgba(59,130,246,0.2); border-radius: 8px; padding: 12px; margin-top: 10px; }
        .nested-amber { background: rgba(245,158,11,0.1); border-color: rgba(245,158,11,0.3); }
        
        /* Super Category */
        .super-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 16px 12px; font-size: 11px; font-weight: 700; }
        .super-btn .emoji { font-size: 24px; }
        .super-btn.selected { background: var(--color-primary) !important; color: white !important; border-color: var(--color-primary) !important; }
        
        /* Category buttons */
        .cat-hero { padding: 16px; font-size: 15px; font-weight: 700; border-radius: 8px; border: 2px solid var(--color-primary); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; margin-bottom: 8px; background: var(--color-primary); color: white; }
        .cat-hero.cat-default { background: #e0f2fe; color: #0369a1; border: 2px dashed #7dd3fc; }
        .cat-hero:hover { opacity: 0.9; }
        .cat-hero.selected { background: var(--color-primary) !important; color: white !important; border: 2px solid var(--color-primary) !important; box-shadow: 0 0 0 4px rgba(59,130,246,0.3); }
        .cat-secondary { background: white; color: var(--color-text); border: 2px solid var(--color-border); padding: 12px; font-size: 13px; font-weight: 600; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .cat-secondary:hover { background: var(--color-background); }
        .cat-secondary.selected { border-color: var(--color-primary) !important; background: var(--color-primary) !important; color: white !important; }
        .cat-other { background: white; color: var(--color-text-muted); border: 1px solid var(--color-border); padding: 8px; font-size: 11px; font-weight: 600; border-radius: 6px; cursor: pointer; }
        .cat-other.selected { border-color: var(--color-primary); background: var(--color-primary); color: white; }
        
        /* Color grid */
        .color-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .color-btn { aspect-ratio: 1; border-radius: 8px; border: 3px solid transparent; cursor: pointer; position: relative; transition: transform 0.1s; }
        .color-btn:hover { transform: scale(1.1); }
        .color-btn.selected { border-color: var(--color-text); box-shadow: 0 0 0 2px white, 0 0 0 4px var(--color-text); }
        .color-btn.selected::after { content: '‚úì'; position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.8); }
        
        /* Cards */
        .cards-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 10px; }
        .card { background: white; border: 2px solid var(--color-border); border-radius: 8px; padding: 12px; cursor: pointer; position: relative; }
        .card:hover { background: var(--color-background); }
        .card.selected { border-color: var(--color-primary); background: var(--color-primary); }
        .card.selected .card-name { color: white !important; }
        .card.selected .card-desc { color: rgba(255,255,255,0.9) !important; }
        .card.priority-1 { grid-column: span 2; background: linear-gradient(135deg, #eff6ff, #dbeafe); border: 2px dashed var(--color-primary); }
        .card.priority-1.selected { border-style: solid; background: var(--color-primary); }
        .card.dimmed { opacity: 0.3; pointer-events: none; }
        .card-name { font-size: 13px; font-weight: 700; color: var(--color-text); }
        .card-desc { font-size: 10px; color: var(--color-text-muted); margin-top: 2px; }
        .card-help { position: absolute; top: 6px; right: 6px; width: 18px; height: 18px; border-radius: 50%; background: rgba(59,130,246,0.1); color: var(--color-primary); font-size: 10px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .card.selected .card-help { background: rgba(255,255,255,0.2); color: white; }
        
        /* Help panel */
        .help-btn { width: 100%; padding: 10px; background: #fef3c7; border: 2px dashed #f59e0b; border-radius: 8px; font-size: 12px; font-weight: 600; color: #92400e; cursor: pointer; }
        .help-panel { background: #fffbeb; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; margin-top: 10px; }
        .help-panel.hidden { display: none; }
        .filter-row { display: flex; gap: 6px; margin-bottom: 8px; }
        .filter-btn { flex: 1; padding: 8px; font-size: 10px; font-weight: 700; text-transform: uppercase; background: white; border: 1px solid var(--color-border); border-radius: 6px; color: var(--color-text-muted); cursor: pointer; }
        .filter-btn.active { background: var(--color-primary); border-color: var(--color-primary); color: white; }
        .help-text { background: #fef3c7; border-radius: 6px; padding: 8px 10px; font-size: 11px; color: #92400e; margin-top: 8px; }
        .help-text.hidden { display: none; }
        
        .tag-warning { background: #fef2f2; border: 2px solid #fca5a5; border-radius: 8px; padding: 10px; font-size: 11px; font-weight: 600; color: #b91c1c; text-align: center; margin-bottom: 10px; }
        .tag-warning.hidden { display: none; }
        
        /* Defect buttons with emoji */
        .defect-card { display: flex; flex-direction: column; align-items: center; padding: 12px 8px; gap: 4px; }
        .defect-card .emoji { font-size: 24px; }
        .defect-card .label { font-size: 10px; font-weight: 700; }
        
        /* Navigation */
        .nav-buttons { display: flex; gap: 12px; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--color-border); }
        .nav-btn { flex: 1; padding: 14px; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; border: none; }
        .nav-btn-back { background: white; color: var(--color-text); border: 2px solid var(--color-border); }
        .nav-btn-next { background: var(--color-primary); color: white; flex: 2; }
        .nav-btn-next:hover { background: var(--color-primary-dark); }
        
        /* Camera */
        .camera-header { background: #111; padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; gap: 12px; border-bottom: 1px solid #333; }
        .camera-select { background: #222; border: 1px solid #444; color: white; padding: 8px 12px; border-radius: 6px; font-size: 12px; flex: 1; max-width: 220px; }
        .camera-status { font-size: 11px; font-weight: 700; color: #555; }
        .camera-status.live { color: #22c55e; }
        .camera-status.live::before { content: '‚óè'; margin-right: 6px; animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }
        .camera-view { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; background: #000; }
        .camera-view-container { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .camera-view video { 
            width: 100%; 
            height: 100%; 
            object-fit: contain; 
            transition: opacity 0.15s ease;
        }
        .camera-view video.switching { opacity: 0.3; }
        .camera-placeholder { color: #444; text-align: center; position: absolute; z-index: 1; }
        .camera-placeholder-icon { font-size: 48px; margin-bottom: 12px; }
        .camera-overlay { position: absolute; inset: 0; pointer-events: none; display: none; }
        .camera-grid { position: absolute; top: 10%; left: 10%; right: 10%; bottom: 10%; border: 2px dashed rgba(255,255,255,0.3); }
        .camera-footer { background: #111; padding: 16px; display: flex; justify-content: center; align-items: center; gap: 16px; border-top: 1px solid #333; }
        .shutter-btn { width: 70px; height: 70px; border-radius: 50%; background: white; border: 4px solid #333; cursor: pointer; }
        .shutter-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(255,255,255,0.3); }
        .shutter-btn:active { transform: scale(0.95); background: #ddd; }
        .shutter-btn.flash { animation: btnflash 0.15s; }
        @keyframes btnflash { 0%{background:white} 50%{background:var(--color-primary)} 100%{background:white} }
        .shutter-hint { color: #555; font-size: 11px; text-align: center; }
        .shutter-hint kbd { background: #333; padding: 3px 6px; border-radius: 4px; font-family: monospace; color: #aaa; }
        .mode-btn { padding: 10px 16px; background: #222; border: 2px solid #333; color: #666; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; line-height: 1.3; min-width: 80px; }
        .mode-btn.active { background: var(--color-primary); border-color: var(--color-primary); color: white; }
        .mode-btn.mode-btn-sku { background: #1a1a2e; border-color: #16a34a; }
        .mode-btn.mode-btn-sku.active { background: #16a34a; border-color: #16a34a; color: white; }
        .mode-btn small { display: block; }
        
        /* Photos panel */
        .photos-header { font-size: 13px; font-weight: 700; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        .photo-count { background: var(--color-primary-light); color: var(--color-primary-dark); padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; }
        .photo-section { margin-bottom: 16px; }
        .photo-section-title { font-size: 10px; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .photo-thumb { aspect-ratio: 1; border-radius: 6px; overflow: hidden; background: white; border: 2px solid var(--color-border); position: relative; cursor: pointer; transition: transform 0.1s, border-color 0.1s; }
        .photo-thumb:hover { transform: scale(1.02); border-color: var(--color-primary); }
        .photo-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .photo-thumb-delete { position: absolute; top: 2px; right: 2px; width: 18px; height: 18px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 11px; display: flex; align-items: center; justify-content: center; opacity: 0; }
        .photo-thumb:hover .photo-thumb-delete { opacity: 1; }
        .photo-thumb-empty { display: flex; align-items: center; justify-content: center; color: var(--color-border); font-size: 18px; cursor: pointer; }
        .stats-section { margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--color-border); }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; text-align: center; }
        .stat-value { font-size: 20px; font-weight: 800; }
        .stat-label { font-size: 9px; color: var(--color-text-muted); text-transform: uppercase; }
        
        .reset-btn { padding: 6px 12px; background: var(--color-error); color: white; border: none; border-radius: 6px; font-size: 11px; font-weight: 600; cursor: pointer; }
        .submit-btn { width: 100%; padding: 16px; background: var(--color-success); color: white; border: none; border-radius: 10px; font-size: 15px; font-weight: 700; cursor: pointer; }
        .submit-btn:disabled { background: var(--color-border); cursor: not-allowed; }
        
        .flash-overlay { position: fixed; inset: 0; background: white; z-index: 500; opacity: 0; pointer-events: none; }
        .flash-overlay.flash { opacity: 1; }
        .hidden { display: none !important; }
        .recording { animation: pulse-red 1s infinite; }
        @keyframes pulse-red { 0%,100%{opacity:1} 50%{opacity:0.7} }
        
        /* Photo Preview Modal */
        .preview-modal { position: fixed; inset: 0; z-index: 600; background: rgba(0,0,0,0.95); display: none; flex-direction: column; }
        .preview-modal.active { display: flex; }
        .preview-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: #111; }
        .preview-title { color: white; font-size: 14px; font-weight: 700; }
        .preview-badge { background: var(--color-primary); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .preview-close { background: none; border: none; color: white; font-size: 28px; cursor: pointer; padding: 8px; }
        .preview-close:hover { color: #f87171; }
        .preview-body { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative; overflow: hidden; }
        .preview-image { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.5); }
        .preview-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.1); border: none; color: white; font-size: 32px; padding: 16px 12px; cursor: pointer; border-radius: 8px; }
        .preview-nav:hover { background: rgba(255,255,255,0.2); }
        .preview-nav.prev { left: 20px; }
        .preview-nav.next { right: 20px; }
        .preview-nav:disabled { opacity: 0.3; cursor: not-allowed; }
        .preview-footer { display: flex; justify-content: center; gap: 12px; padding: 16px; background: #111; }
        .preview-btn { padding: 12px 24px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; border: none; }
        .preview-btn-delete { background: #ef4444; color: white; }
        .preview-btn-delete:hover { background: #dc2626; }
        .preview-btn-close { background: #374151; color: white; }
        .preview-btn-close:hover { background: #4b5563; }
        .preview-counter { color: #9ca3af; font-size: 12px; position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); }
        
        /* SKU with scan button */
        .sku-row { display: flex; gap: 8px; }
        .sku-row input { flex: 1; }
        .scan-btn { background: #1e293b; color: white; border: none; padding: 10px 16px; border-radius: 8px; font-size: 18px; cursor: pointer; }
        .scan-btn:hover { background: #334155; }
        
        /* Review cards */
        .review-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 16px; }
        .review-card { border-radius: 10px; padding: 14px; cursor: pointer; transition: transform 0.1s; }
        .review-card:hover { transform: scale(0.98); }
        .review-card:active { transform: scale(0.96); }
        .card-green { border-left: 4px solid var(--color-success); background: #f0fdf4; }
        .card-yellow { border-left: 4px solid var(--color-warning); background: #fffbeb; }
        .review-card-header { display: flex; align-items: center; gap: 6px; margin-bottom: 6px; }
        .review-card-header .icon { font-size: 16px; }
        .review-card-header .title { font-size: 12px; font-weight: 700; color: var(--color-text); }
        .review-card-summary { font-size: 11px; color: var(--color-text-muted); line-height: 1.4; }
        .review-banner { background: var(--color-success); color: white; padding: 14px; border-radius: 10px; text-align: center; font-weight: 700; margin-bottom: 12px; }
        .flag-banner { background: #fef3c7; border: 2px solid #f59e0b; color: #92400e; padding: 12px; border-radius: 10px; text-align: center; font-weight: 700; margin-bottom: 12px; }
    </style>
</head>
<body>
    <!-- PIN LOCK SCREEN -->
    <div id="pin-screen" class="pin-screen">
        <div class="pin-box">
            <div class="pin-title">VintageLister</div>
            <div class="pin-subtitle">Enter Warehouse PIN</div>
            <input type="tel" id="pin-input" class="pin-input" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" inputmode="numeric" autocomplete="off">
            <div class="sub-label">Photographer</div>
            <select id="photographer-select" class="photographer-select">
                <option value="P01">P01 ‚Äì Jeff Koga</option>
                <option value="P02" selected>P02 ‚Äì Elaine Donato</option>
                <option value="P03">P03 ‚Äì Kobe Gaza</option>
            </select>
            <button onclick="checkPin()" class="pin-btn">START LISTING ‚Üí</button>
        </div>
        <div class="pin-version">v98.7 Desktop Station</div>
    </div>
    
    <div class="flash-overlay" id="flash-overlay"></div>
    
    <!-- PHOTO PREVIEW MODAL -->
    <div class="preview-modal" id="preview-modal">
        <div class="preview-header">
            <span class="preview-title">Photo Preview</span>
            <span class="preview-badge" id="preview-type">MAIN</span>
            <button class="preview-close" onclick="closePreview()">√ó</button>
        </div>
        <div class="preview-body">
            <button class="preview-nav prev" id="preview-prev" onclick="navigatePreview(-1)">‚Äπ</button>
            <img id="preview-image" class="preview-image" src="" alt="Preview">
            <button class="preview-nav next" id="preview-next" onclick="navigatePreview(1)">‚Ä∫</button>
            <div class="preview-counter" id="preview-counter">1 / 1</div>
        </div>
        <div class="preview-footer">
            <button class="preview-btn preview-btn-delete" onclick="deleteFromPreview()">üóëÔ∏è Delete Photo</button>
            <button class="preview-btn preview-btn-close" onclick="closePreview()">Close</button>
        </div>
    </div>
    
    <div class="desktop-layout">
        <!-- LEFT: Form Panel -->
        <div class="form-panel">
            <div class="floating-timer">
                <div>
                    <div class="timer-label">CURRENT ITEM</div>
                    <div class="timer-main" id="timer-current">0:00</div>
                </div>
                <div class="timer-stats">
                    <div>Avg: <strong id="timer-avg">--</strong></div>
                    <div>Last: <strong id="timer-last">--</strong></div>
                </div>
                <div>
                    <span id="photographer-badge" class="photographer-badge" onclick="showPinScreen()">P02</span>
                    <button class="reset-btn" onclick="resetForm()" style="margin-left:8px;">‚Üª</button>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-dot active" id="dot-1" onclick="goToStep(1)"></div>
                <div class="progress-dot" id="dot-2" onclick="goToStep(2)"></div>
                <div class="progress-dot" id="dot-3" onclick="goToStep(3)"></div>
                <div class="progress-dot" id="dot-4" onclick="goToStep(4)"></div>
                <span class="progress-label" id="step-label">Step 1: Tag</span>
                <span class="category-badge" id="category-label"></span>
                <span class="sku-badge" id="sku-badge"></span>
            </div>
            
            <div class="step-area">
                <!-- STEP 1: TAG -->
                <div id="step-1" class="step-container active">
                    <div class="section-card">
                        <div class="section-label"><span id="check-category" class="check-circle">‚óã</span> What is it?</div>
                        <div class="btn-grid btn-grid-3" style="margin-bottom:12px;">
                            <button onclick="setSuperCategory('tops', this)" class="btn btn-hero super-btn selected"><span class="emoji">üëï</span>TOPS</button>
                            <button onclick="setSuperCategory('bottoms', this)" class="btn btn-secondary super-btn"><span class="emoji">üëñ</span>BOTTOMS</button>
                            <button onclick="setSuperCategory('outer', this)" class="btn btn-secondary super-btn"><span class="emoji">üß•</span>OUTER</button>
                        </div>
                        <div id="sub-categories"></div>
                    </div>
                    
                    <div class="section-card">
                        <div class="section-label"><span id="check-tag" class="check-circle">‚óã</span> Tag Info</div>
                        <button onclick="setTagStatus('has', this)" class="btn btn-default tag-btn" style="width:100%;margin-bottom:8px;">‚úì TAG READABLE</button>
                        <div class="btn-grid btn-grid-2">
                            <button onclick="setTagStatus('worn', this)" class="btn btn-tertiary tag-btn">üëÄ Worn/Faded</button>
                            <button onclick="setTagStatus('none', this)" class="btn btn-tertiary tag-btn">‚úÇÔ∏è Missing/Cut</button>
                        </div>
                        
                        <div id="tag-details" class="hidden nested-section">
                            <div class="sub-label">Tag Size</div>
                            <div class="btn-grid btn-grid-4" style="margin-bottom:8px;">
                                <button onclick="setSize('XS', this)" class="btn btn-tertiary size-btn">XS</button>
                                <button onclick="setSize('S', this)" class="btn btn-tertiary size-btn">S</button>
                                <button onclick="setSize('M', this)" class="btn btn-tertiary size-btn">M</button>
                                <button onclick="setSize('L', this)" class="btn btn-tertiary size-btn">L</button>
                                <button onclick="setSize('XL', this)" class="btn btn-tertiary size-btn">XL</button>
                                <button onclick="setSize('2XL', this)" class="btn btn-tertiary size-btn">2XL</button>
                                <button onclick="setSize('3XL', this)" class="btn btn-tertiary size-btn">3XL</button>
                                <button onclick="setSize('4XL', this)" class="btn btn-tertiary size-btn">4XL</button>
                            </div>
                            <div class="sub-label">Origin</div>
                            <div class="btn-grid btn-grid-2" style="margin-bottom:8px;">
                                <button onclick="setOrigin('usa', this)" class="btn btn-default origin-btn">üá∫üá∏ USA Made</button>
                                <button onclick="setOrigin('import', this)" class="btn btn-tertiary origin-btn">üåç Import</button>
                            </div>
                            <div id="country-section" class="hidden">
                                <div class="btn-grid btn-grid-3">
                                    <button onclick="setCountry('China', this)" class="btn btn-tertiary country-btn">üá®üá≥ China</button>
                                    <button onclick="setCountry('Vietnam', this)" class="btn btn-tertiary country-btn">üáªüá≥ Vietnam</button>
                                    <button onclick="setCountry('Bangladesh', this)" class="btn btn-tertiary country-btn">üáßüá© Bangladesh</button>
                                    <button onclick="setCountry('Mexico', this)" class="btn btn-tertiary country-btn">üá≤üáΩ Mexico</button>
                                    <button onclick="setCountry('Honduras', this)" class="btn btn-tertiary country-btn">üá≠üá≥ Honduras</button>
                                    <button onclick="setCountry('Philippines', this)" class="btn btn-tertiary country-btn">üáµüá≠ Philippines</button>
                                </div>
                            </div>
                            <div class="sub-label">Gender on Tag</div>
                            <div class="btn-grid btn-grid-4">
                                <button onclick="setGender('Men', this)" class="btn btn-tertiary gender-btn">Men's</button>
                                <button onclick="setGender('Women', this)" class="btn btn-tertiary gender-btn">Women's</button>
                                <button onclick="setGender('Unisex', this)" class="btn btn-tertiary gender-btn">Unisex</button>
                                <button onclick="setGender('None', this)" class="btn btn-tertiary gender-btn">None</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button onclick="goToStep(2)" class="nav-btn nav-btn-next">Next: Check ‚Üí</button>
                    </div>
                </div>
                
                <!-- STEP 2: CHECK -->
                <div id="step-2" class="step-container">
                    <div class="section-card">
                        <div class="section-label"><span id="check-color" class="check-circle">‚óã</span> Color(s)</div>
                        <div class="color-grid">
                            <button onclick="toggleColor('Black', this)" class="color-btn" style="background:#000" title="Black"></button>
                            <button onclick="toggleColor('White', this)" class="color-btn" style="background:#FFF;border:1px solid #ddd" title="White"></button>
                            <button onclick="toggleColor('Gray', this)" class="color-btn" style="background:#808080" title="Gray"></button>
                            <button onclick="toggleColor('Navy', this)" class="color-btn" style="background:#000080" title="Navy"></button>
                            <button onclick="toggleColor('Blue', this)" class="color-btn" style="background:#0066FF" title="Blue"></button>
                            <button onclick="toggleColor('Red', this)" class="color-btn" style="background:#FF0000" title="Red"></button>
                            <button onclick="toggleColor('Green', this)" class="color-btn" style="background:#008000" title="Green"></button>
                            <button onclick="toggleColor('Yellow', this)" class="color-btn" style="background:#FFD700" title="Yellow"></button>
                            <button onclick="toggleColor('Orange', this)" class="color-btn" style="background:#FF8C00" title="Orange"></button>
                            <button onclick="toggleColor('Purple', this)" class="color-btn" style="background:#800080" title="Purple"></button>
                            <button onclick="toggleColor('Pink', this)" class="color-btn" style="background:#FF69B4" title="Pink"></button>
                            <button onclick="toggleColor('Brown', this)" class="color-btn" style="background:#8B4513" title="Brown"></button>
                            <button onclick="toggleColor('Tan', this)" class="color-btn" style="background:#D2B48C" title="Tan"></button>
                            <button onclick="toggleColor('Cream', this)" class="color-btn" style="background:#FFFDD0;border:1px solid #ddd" title="Cream"></button>
                            <button onclick="toggleColor('Multi', this)" class="color-btn" style="background:conic-gradient(red,orange,yellow,green,blue,purple,red)" title="Multi"></button>
                        </div>
                    </div>
                    
                    <!-- FADE -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-fade" class="check-circle">‚óã</span> Fade Level</div>
                        <div class="btn-grid btn-grid-3">
                            <button onclick="setFade('None', this)" class="btn btn-default fade-btn">None</button>
                            <button onclick="setFade('Light', this)" class="btn btn-tertiary fade-btn">Light</button>
                            <button onclick="setFade('Heavy', this)" class="btn btn-tertiary fade-btn">Heavy</button>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="section-label"><span id="check-pattern" class="check-circle">‚óã</span> Pattern</div>
                        <div class="btn-grid btn-grid-3">
                            <button onclick="setPattern('Solid', this)" class="btn btn-default pattern-btn">Solid</button>
                            <button onclick="setPattern('Striped', this)" class="btn btn-tertiary pattern-btn">Striped</button>
                            <button onclick="setPattern('Graphic', this)" class="btn btn-tertiary pattern-btn">Graphic</button>
                            <button onclick="setPattern('Plaid', this)" class="btn btn-tertiary pattern-btn">Plaid</button>
                            <button onclick="setPattern('Logo', this)" class="btn btn-tertiary pattern-btn">Logo</button>
                            <button onclick="setPattern('Other', this)" class="btn btn-tertiary pattern-btn">Other</button>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="section-label"><span id="check-fabric-type" class="check-circle">‚óã</span> Fabric Type</div>
                        <div id="fabric-cards-grid" class="cards-grid"></div>
                        <!-- Denim Wash (shows when denim selected) -->
                        <div id="wash-section" class="hidden nested-section" style="margin-top:10px;">
                            <div class="sub-label" style="color:#0369a1;">Denim Wash</div>
                            <div class="btn-grid btn-grid-4">
                                <button onclick="setWash('Light', this)" class="btn btn-tertiary wash-btn">Light</button>
                                <button onclick="setWash('Medium', this)" class="btn btn-tertiary wash-btn">Medium</button>
                                <button onclick="setWash('Dark', this)" class="btn btn-default wash-btn">Dark</button>
                                <button onclick="setWash('Raw', this)" class="btn btn-tertiary wash-btn">Raw</button>
                                <button onclick="setWash('Acid', this)" class="btn btn-tertiary wash-btn">Acid</button>
                                <button onclick="setWash('Stone', this)" class="btn btn-tertiary wash-btn">Stone</button>
                                <button onclick="setWash('Rinse', this)" class="btn btn-tertiary wash-btn">Rinse</button>
                                <button onclick="setWash('Black', this)" class="btn btn-tertiary wash-btn">Black</button>
                            </div>
                        </div>
                        <button id="fabric-help-btn" onclick="toggleFabricHelp()" class="help-btn" style="margin-top:8px;">ü§î Not Sure?</button>
                        <div id="fabric-help-panel" class="help-panel hidden">
                            <div class="sub-label" style="color:#92400e;">How does it feel?</div>
                            <div class="filter-row">
                                <button onclick="toggleFabricFilter('stretch','none',this)" class="filter-btn fabric-filter">Rigid</button>
                                <button onclick="toggleFabricFilter('stretch','high',this)" class="filter-btn fabric-filter">Stretchy</button>
                            </div>
                            <div class="sub-label" style="color:#92400e;">Inside?</div>
                            <div class="filter-row">
                                <button onclick="toggleFabricFilter('interior','smooth',this)" class="filter-btn fabric-filter">Smooth</button>
                                <button onclick="toggleFabricFilter('interior','fuzzy',this)" class="filter-btn fabric-filter">Fuzzy</button>
                                <button onclick="toggleFabricFilter('interior','loops',this)" class="filter-btn fabric-filter">Loops</button>
                            </div>
                            <div id="fabric-helper" class="help-text hidden"></div>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="section-label"><span id="check-material" class="check-circle">‚óã</span> Material</div>
                        <div id="material-tag-warning" class="tag-warning hidden">‚ö†Ô∏è No readable tag ‚Äî use touch tests</div>
                        <div id="material-cards-grid" class="cards-grid"></div>
                        <button id="material-help-btn" onclick="toggleMaterialHelp()" class="help-btn">ü§î Not Sure?</button>
                        <div id="material-help-panel" class="help-panel hidden">
                            <div class="sub-label" style="color:#92400e;">Temperature?</div>
                            <div class="filter-row">
                                <button onclick="toggleMaterialFilter('temp','cool',this)" class="filter-btn material-filter">Cool</button>
                                <button onclick="toggleMaterialFilter('temp','warm',this)" class="filter-btn material-filter">Warm</button>
                            </div>
                            <div class="sub-label" style="color:#92400e;">Shine?</div>
                            <div class="filter-row">
                                <button onclick="toggleMaterialFilter('shine','matte',this)" class="filter-btn material-filter">Matte</button>
                                <button onclick="toggleMaterialFilter('shine','sheen',this)" class="filter-btn material-filter">Sheen</button>
                            </div>
                            <div id="material-helper" class="help-text hidden"></div>
                        </div>
                    </div>
                    
                    <div class="section-card" id="construction-section">
                        <div class="section-label"><span id="check-construction" class="check-circle">‚óã</span> Construction</div>
                        <div class="sub-label">Sleeve Length</div>
                        <div class="btn-grid btn-grid-4" style="margin-bottom:10px;">
                            <button onclick="setSleeve('Short', this)" class="btn btn-default sleeve-btn">Short</button>
                            <button onclick="setSleeve('Long', this)" class="btn btn-tertiary sleeve-btn">Long</button>
                            <button onclick="setSleeve('3/4', this)" class="btn btn-tertiary sleeve-btn">3/4</button>
                            <button onclick="setSleeve('None', this)" class="btn btn-tertiary sleeve-btn">None</button>
                        </div>
                        <div id="sleeve-style-section">
                            <div class="sub-label">Sleeve Style</div>
                            <div class="btn-grid btn-grid-3" style="margin-bottom:10px;">
                                <button onclick="setSleeveStyle('Standard', this)" class="btn btn-default style-btn">Standard</button>
                                <button onclick="setSleeveStyle('Raglan', this)" class="btn btn-tertiary style-btn">Raglan</button>
                                <button onclick="setSleeveStyle('Dolman', this)" class="btn btn-tertiary style-btn">Dolman</button>
                            </div>
                        </div>
                        <div id="stitch-section">
                            <div class="sub-label">Stitch Type</div>
                            <div class="btn-grid btn-grid-2">
                                <button onclick="setStitch('Single', this)" class="btn btn-tertiary stitch-btn">Single Stitch</button>
                                <button onclick="setStitch('Double', this)" class="btn btn-default stitch-btn">Double Stitch</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="section-label"><span id="check-feel" class="check-circle">‚óã</span> Feel</div>
                        <div class="sub-label">Thickness</div>
                        <div class="btn-grid btn-grid-4" style="margin-bottom:10px;">
                            <button onclick="setThickness('Paper', this)" class="btn btn-tertiary thickness-btn">Paper</button>
                            <button onclick="setThickness('Light', this)" class="btn btn-tertiary thickness-btn">Light</button>
                            <button onclick="setThickness('Standard', this)" class="btn btn-default thickness-btn">Standard</button>
                            <button onclick="setThickness('Heavy', this)" class="btn btn-tertiary thickness-btn">Heavy</button>
                        </div>
                        <div class="sub-label">Layers</div>
                        <div class="btn-grid btn-grid-3">
                            <button onclick="setLayers('Single', this)" class="btn btn-default layers-btn">Single</button>
                            <button onclick="setLayers('Reversible', this)" class="btn btn-tertiary layers-btn">Reversible</button>
                            <button onclick="setLayers('Lined', this)" class="btn btn-tertiary layers-btn">Lined</button>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button onclick="goToStep(1)" class="nav-btn nav-btn-back">‚Üê Back</button>
                        <button onclick="goToStep(3)" class="nav-btn nav-btn-next">Next: Snap ‚Üí</button>
                    </div>
                </div>
                
                <!-- STEP 3: SNAP & SEND -->
                <div id="step-3" class="step-container">
                    <div class="section-card">
                        <div class="section-label"><span id="check-condition" class="check-circle">‚óã</span> Any Issues?</div>
                        <button onclick="setClean(this)" id="btn-clean" class="btn btn-default" style="width:100%;margin-bottom:10px;padding:14px;">‚úì No Defects</button>
                        <div class="sub-label">Or tap defect type:</div>
                        <div class="btn-grid btn-grid-3">
                            <button onclick="toggleDefect('Stain', this)" class="btn btn-tertiary defect-type-btn defect-card"><span class="emoji">üíß</span><span class="label">Stain</span></button>
                            <button onclick="toggleDefect('Hole', this)" class="btn btn-tertiary defect-type-btn defect-card"><span class="emoji">üï≥Ô∏è</span><span class="label">Hole</span></button>
                            <button onclick="toggleDefect('Repair', this)" class="btn btn-tertiary defect-type-btn defect-card"><span class="emoji">üßµ</span><span class="label">Repair</span></button>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="section-label"><span id="check-weight" class="check-circle">‚óã</span> ‚öñÔ∏è Weight</div>
                        <div class="btn-grid btn-grid-2">
                            <select id="weight-lb" onchange="updateWeight()" class="form-select" style="font-size:16px;font-weight:700;">
                                <option value="0" selected>0 lb</option>
                                <option value="1">1 lb</option>
                                <option value="2">2 lb</option>
                                <option value="3">3 lb</option>
                                <option value="4">4 lb</option>
                                <option value="5">5 lb</option>
                            </select>
                            <select id="weight-oz" onchange="updateWeight()" class="form-select" style="font-size:16px;font-weight:700;">
                                <option value="0" selected>0 oz</option>
                                <option value="3">3 oz</option>
                                <option value="4">4 oz</option>
                                <option value="5">5 oz</option>
                                <option value="6">6 oz</option>
                                <option value="7">7 oz</option>
                                <option value="8">8 oz</option>
                                <option value="9">9 oz</option>
                                <option value="10">10 oz</option>
                                <option value="11">11 oz</option>
                                <option value="12">12 oz</option>
                                <option value="13">13 oz</option>
                                <option value="14">14 oz</option>
                                <option value="15">15 oz</option>
                            </select>
                        </div>
                        <div style="margin-top:8px;font-size:11px;color:var(--color-text-muted);">‚¨ÜÔ∏è <strong>Always round up</strong></div>
                    </div>
                    
                    <!-- AUDIO MEASUREMENTS -->
                    <div class="section-card">
                        <div class="section-label"><span id="check-audio" class="check-circle">‚óã</span> üé§ Measurements</div>
                        <div id="measure-hint" class="nested-section" style="margin-bottom:10px;background:#eff6ff;border-color:#bfdbfe;">
                            <div style="font-size:11px;font-weight:700;color:#1e40af;margin-bottom:6px;">Say each + "inches":</div>
                            <div style="font-size:10px;color:#3b82f6;line-height:1.6;">1. Shoulder to shoulder<br>2. Pit to pit chest<br>3. Waist<br>4. Bottom hem<br>5. Length<br>6. Sleeve</div>
                        </div>
                        <div id="record-section">
                            <button id="record-btn" onclick="toggleRecording()" class="btn btn-hero" style="width:100%;background:#ef4444;padding:16px;display:flex;flex-direction:column;align-items:center;gap:4px;">
                                <span style="font-size:24px;">üé§</span>
                                <span>TAP TO RECORD</span>
                            </button>
                        </div>
                        <div id="post-record-section" class="hidden">
                            <div class="nested-section" style="background:#f0fdf4;border-color:#86efac;text-align:center;margin-bottom:8px;">
                                <div style="color:#16a34a;font-weight:700;font-size:14px;">‚úì RECORDED</div>
                                <div style="color:#22c55e;font-family:monospace;font-size:18px;" id="recording-duration">0:00</div>
                            </div>
                            <button onclick="reRecord()" style="width:100%;padding:8px;background:none;border:none;color:var(--color-text-muted);font-size:12px;text-decoration:underline;cursor:pointer;">Re-record</button>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="section-label"><span id="check-sku" class="check-circle">‚óã</span> SKU</div>
                        <div class="sku-row">
                            <input type="text" id="sku-input" class="form-input" placeholder="Scan barcode..." inputmode="numeric" oninput="onSkuInput()" onkeydown="if(event.key==='Enter'){event.preventDefault();this.blur();}" style="font-size:18px;font-family:monospace;">
                            <button onclick="setPhotoMode('sku')" class="scan-btn" title="Scan with C922X">üì∑</button>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <button onclick="goToStep(2)" class="nav-btn nav-btn-back">‚Üê Back</button>
                        <button onclick="goToStep(4)" class="nav-btn nav-btn-next" style="flex:2;">Next: Review ‚Üí</button>
                    </div>
                </div>
                
                <!-- STEP 4: REVIEW -->
                <div id="step-4" class="step-container">
                    <div class="review-banner">‚ú® Almost done! Quick review</div>
                    
                    <div class="review-grid">
                        <div id="card-tag" onclick="goToStep(1)" class="review-card card-yellow">
                            <div class="review-card-header">
                                <span class="icon" id="icon-tag">‚ö†Ô∏è</span>
                                <span class="title">TAG</span>
                            </div>
                            <div class="review-card-summary" id="summary-tag">--</div>
                        </div>
                        <div id="card-check" onclick="goToStep(2)" class="review-card card-yellow">
                            <div class="review-card-header">
                                <span class="icon" id="icon-check">‚ö†Ô∏è</span>
                                <span class="title">CHECK</span>
                            </div>
                            <div class="review-card-summary" id="summary-check">--</div>
                        </div>
                        <div id="card-snap" onclick="goToStep(3)" class="review-card card-yellow">
                            <div class="review-card-header">
                                <span class="icon" id="icon-snap">‚ö†Ô∏è</span>
                                <span class="title">SNAP</span>
                            </div>
                            <div class="review-card-summary" id="summary-snap">--</div>
                        </div>
                        <div id="card-weight" onclick="goToStep(3)" class="review-card card-yellow">
                            <div class="review-card-header">
                                <span class="icon" id="icon-weight">‚ö†Ô∏è</span>
                                <span class="title">WEIGHT</span>
                            </div>
                            <div class="review-card-summary" id="summary-weight">--</div>
                        </div>
                    </div>
                    
                    <div id="flag-status" class="flag-banner hidden">üö© FLAGGED FOR REVIEW</div>
                    
                    <button id="submit-btn" class="submit-btn" onclick="submitItem()" disabled>SUBMIT ‚úì</button>
                    
                    <div class="nav-buttons" style="border-top:none;padding-top:8px;">
                        <button onclick="goToStep(3)" class="nav-btn nav-btn-back" style="flex:1;">‚Üê Back</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CENTER: Camera -->
        <div class="camera-panel">
            <div class="camera-header">
                <select id="camera-select" class="camera-select" onchange="switchCamera(this.value)"><option value="">Select Camera...</option></select>
                <span id="camera-indicator" style="background:#3b82f6;color:white;padding:6px 12px;border-radius:6px;font-size:11px;font-weight:700;">üì¶ BRIO</span>
                <span id="camera-resolution" style="color:#6b7280;font-size:10px;font-family:monospace;">--</span>
                <span style="background:#16a34a;color:white;padding:3px 8px;border-radius:4px;font-size:9px;font-weight:700;">FULL RES</span>
                <div id="camera-status" class="camera-status">No camera</div>
            </div>
            <div class="camera-view">
                <div class="camera-view-container">
                    <div class="camera-placeholder" id="camera-placeholder">
                        <div class="camera-placeholder-icon">üì∑</div>
                        <div>Select a camera to begin</div>
                        <div style="font-size:11px;margin-top:6px;color:#555;">Logitech Brio 4K recommended</div>
                    </div>
                    <video id="camera-video" autoplay playsinline style="display:none;"></video>
                    <div class="camera-overlay" id="camera-overlay"><div class="camera-grid"></div></div>
                </div>
            </div>
            <div class="camera-footer">
                <button class="mode-btn active" id="mode-main" onclick="setPhotoMode('main')">üì¶ Main<br><small style="font-size:9px;opacity:0.7;">Brio</small></button>
                <button class="mode-btn" id="mode-tag" onclick="setPhotoMode('tag')">üè∑Ô∏è Tag<br><small style="font-size:9px;opacity:0.7;">C922X</small></button>
                <div style="text-align:center;">
                    <button class="shutter-btn" id="shutter-btn" onclick="capturePhoto()"></button>
                    <div class="shutter-hint">Press <kbd>SPACE</kbd> or foot pedal</div>
                </div>
                <button class="mode-btn" id="mode-defect" onclick="setPhotoMode('defect')">‚ö†Ô∏è Defects<br><small style="font-size:9px;opacity:0.7;">C922X</small></button>
                <button class="mode-btn mode-btn-sku" id="mode-sku" onclick="setPhotoMode('sku')">üì∑ SKU<br><small style="font-size:9px;opacity:0.7;">C922X</small></button>
            </div>
        </div>
        
        <!-- RIGHT: Photos -->
        <div class="photos-panel">
            <div class="photos-header"><span>Photos</span><span class="photo-count" id="photo-count">0</span></div>
            <div style="font-size:9px;color:var(--color-text-muted);margin-bottom:12px;">Double-click to preview</div>
            <div class="photo-section">
                <div class="photo-section-title"><span>Main Photos</span><span id="main-count">0</span></div>
                <div class="photo-grid" id="main-photos-grid"><div class="photo-thumb photo-thumb-empty" onclick="setPhotoMode('main')">+</div></div>
            </div>
            <div class="photo-section">
                <div class="photo-section-title"><span>Tag Photos</span><span id="tag-count">0</span></div>
                <div class="photo-grid" id="tag-photos-grid"><div class="photo-thumb photo-thumb-empty" onclick="setPhotoMode('tag')">+</div></div>
            </div>
            <div class="photo-section">
                <div class="photo-section-title"><span>Defect Photos</span><span id="defect-count">0</span></div>
                <div class="photo-grid" id="defect-photos-grid"><div class="photo-thumb photo-thumb-empty" onclick="setPhotoMode('defect')">+</div></div>
            </div>
            <div class="stats-section">
                <div style="font-size:10px;color:var(--color-text-muted);font-weight:700;margin-bottom:8px;">Today's Stats</div>
                <div class="stats-grid">
                    <div><div class="stat-value" style="color:var(--color-primary)" id="stat-today">0</div><div class="stat-label">Today</div></div>
                    <div><div class="stat-value" style="color:var(--color-success)" id="stat-week">0</div><div class="stat-label">Week</div></div>
                    <div><div class="stat-value" id="stat-total">0</div><div class="stat-label">Total</div></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const APP_PIN = "1234";
        const N8N_WEBHOOK_URL = "https://jeffkoga.app.n8n.cloud/webhook/0845a6d3-be69-4b68-aba7-28f55112678c";
        let data = { superCategory:'tops', category:'', tagStatus:'', tagSize:'', origin:'', country:'', gender:'', colors:[], fade:'', pattern:'', fabricType:'', wash:'', material:'', sleeveLength:'', sleeveStyle:'', stitch:'', thickness:'', layers:'', hasDefects:null, defectTypes:[], weightLb:0, weightOz:0, sku:'', photographer:'P02', audioMeasure:null, audioDuration:0, mainPhotos:[], tagPhotos:[], defectPhotos:[] };
        let stats = { today:0, week:0, total:0 }, currentStep = 1, photoMode = 'main', currentStream = null;
        let fabricFilters = { stretch:null, interior:null }, materialFilters = { temp:null, shine:null };
        let timerStart = null, timerInterval = null, itemTimes = [];
        let mediaRecorder = null, audioChunks = [], recordingStart = null, recordingInterval = null;
        let mainCameraId = null, secondaryCameraId = null, activeCameraId = null;
        let previewMode = null, previewIndex = 0;

        const categoryConfig = {
            tops: { heroes: ['T-Shirt', 'Sweatshirt', 'Hoodie'], others: ['Sweater', 'Button Shirt', 'Polo', 'Jersey', 'Tank Top', 'Cardigan', 'Blouse', 'Tunic'] },
            bottoms: { heroes: ['Jeans', 'Pants'], others: ['Shorts', 'Sweatpants'] },
            outer: { heroes: ['Jacket', 'Coat'], others: ['Vest'] }
        };
        const catEmojis = { 'T-Shirt':'üëï', 'Sweatshirt':'üèãÔ∏è', 'Hoodie':'üß•', 'Sweater':'üß∂', 'Button Shirt':'üëî', 'Polo':'üèåÔ∏è', 'Jersey':'üèÄ', 'Tank Top':'ü©±', 'Cardigan':'üß•', 'Jeans':'üëñ', 'Pants':'üëñ', 'Shorts':'ü©≥', 'Sweatpants':'üèÉ', 'Jacket':'üß•', 'Coat':'üß•', 'Vest':'ü¶∫', 'Blouse':'üëö', 'Tunic':'üëó' };
        
        const fabricDB = {
            "T-Shirt": [{ name:"Knit", priority:1, default:true, traits:{stretch:"high",interior:"smooth"}, desc:"Standard tee." },{ name:"Jersey", priority:2, traits:{stretch:"high",interior:"smooth"}, desc:"eBay term for knit." },{ name:"Mesh", priority:3, traits:{stretch:"high",interior:"smooth"}, desc:"See-through." }],
            "Sweatshirt": [{ name:"Fleece", priority:1, default:true, traits:{stretch:"high",interior:"fuzzy"}, desc:"Fuzzy inside." },{ name:"French Terry", priority:2, traits:{stretch:"high",interior:"loops"}, desc:"Loops inside." }],
            "Hoodie": [{ name:"Fleece", priority:1, default:true, traits:{stretch:"high",interior:"fuzzy"}, desc:"Fuzzy inside." },{ name:"French Terry", priority:2, traits:{stretch:"high",interior:"loops"}, desc:"Loops inside." }],
            "Button Shirt": [{ name:"Woven", priority:1, default:true, traits:{stretch:"none",interior:"smooth"}, desc:"Dress shirt." },{ name:"Flannel", priority:1, traits:{stretch:"none",interior:"fuzzy"}, desc:"Soft, brushed." },{ name:"Denim", priority:2, traits:{stretch:"none",interior:"smooth"}, desc:"Western shirt." }],
            "Jeans": [{ name:"Denim", priority:1, default:true, traits:{stretch:"none",interior:"smooth"}, desc:"Standard jean." },{ name:"Selvage", priority:2, traits:{stretch:"none",interior:"smooth"}, desc:"Premium." }],
            "Pants": [{ name:"Twill", priority:1, default:true, traits:{stretch:"none",interior:"smooth"}, desc:"Chinos." },{ name:"Corduroy", priority:2, traits:{stretch:"none",interior:"smooth"}, desc:"Ridges." }],
            "Jacket": [{ name:"Nylon", priority:1, default:true, traits:{stretch:"none",interior:"smooth"}, desc:"Windbreaker." },{ name:"Denim", priority:1, traits:{stretch:"none",interior:"smooth"}, desc:"Jean jacket." },{ name:"Leather", priority:2, traits:{stretch:"none",interior:"smooth"}, desc:"Moto." }],
            "default": [{ name:"Knit", priority:1, default:true, traits:{stretch:"high",interior:"smooth"}, desc:"Standard." }]
        };
        const materialDB = {
            "T-Shirt": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"Natural. Cool, soft." },{ name:"50/50 Blend", priority:1, traits:{temp:"cool",shine:"matte"}, desc:"Cotton/Poly mix." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen"}, desc:"Synthetic. Slight sheen." },{ name:"Rayon", priority:2, traits:{temp:"cool",shine:"sheen"}, desc:"Silky, drapey." },{ name:"Tri-Blend", priority:2, traits:{temp:"cool",shine:"matte"}, desc:"Ultra soft." }],
            "Sweatshirt": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"Natural." },{ name:"Cotton/Poly", priority:1, traits:{temp:"cool",shine:"matte"}, desc:"Blend." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen"}, desc:"Athletic." }],
            "Hoodie": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"Natural." },{ name:"Cotton/Poly", priority:1, traits:{temp:"cool",shine:"matte"}, desc:"Blend." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen"}, desc:"Tech fleece." }],
            "Sweater": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"Lightweight." },{ name:"Wool", priority:1, traits:{temp:"warm",shine:"matte"}, desc:"Warm, can be itchy." },{ name:"Acrylic", priority:2, traits:{temp:"warm",shine:"matte"}, desc:"Synthetic wool." },{ name:"Cashmere", priority:3, traits:{temp:"warm",shine:"matte"}, desc:"Luxury. Ultra soft." }],
            "Cardigan": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"Lightweight." },{ name:"Wool", priority:1, traits:{temp:"warm",shine:"matte"}, desc:"Classic." },{ name:"Acrylic", priority:2, traits:{temp:"warm",shine:"matte"}, desc:"Synthetic." }],
            "Button Shirt": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"Natural. Crisp." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen"}, desc:"Wrinkle-free." },{ name:"Linen", priority:2, traits:{temp:"cool",shine:"matte"}, desc:"Cool, wrinkles." },{ name:"Rayon", priority:2, traits:{temp:"cool",shine:"sheen"}, desc:"Silky." },{ name:"Silk", priority:3, traits:{temp:"cool",shine:"sheen"}, desc:"Luxury. Shiny." }],
            "Polo": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"Classic polo." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen"}, desc:"Athletic." }],
            "Jeans": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"100% denim." },{ name:"Cotton/Spandex", priority:2, traits:{temp:"cool",shine:"matte"}, desc:"Stretch." }],
            "Pants": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"Chinos." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen"}, desc:"Dress pants." },{ name:"Wool", priority:2, traits:{temp:"warm",shine:"matte"}, desc:"Dress wool." }],
            "Jacket": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"Canvas/denim." },{ name:"Nylon", priority:1, traits:{temp:"warm",shine:"sheen"}, desc:"Windbreaker." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen"}, desc:"Athletic." },{ name:"Leather", priority:2, traits:{temp:"cool",shine:"sheen"}, desc:"Real leather." }],
            "Coat": [{ name:"Wool", priority:1, default:true, traits:{temp:"warm",shine:"matte"}, desc:"Dress coat." },{ name:"Cotton", priority:2, traits:{temp:"cool",shine:"matte"}, desc:"Trench." },{ name:"Down", priority:2, traits:{temp:"warm",shine:"matte"}, desc:"Puffer." }],
            "default": [{ name:"Cotton", priority:1, default:true, traits:{temp:"cool",shine:"matte"}, desc:"Natural." },{ name:"Polyester", priority:2, traits:{temp:"warm",shine:"sheen"}, desc:"Synthetic." }]
        };

        document.addEventListener('DOMContentLoaded', () => { 
            checkAuth(); loadStats(); enumerateCameras(); renderSubCategories('tops'); renderFabricCards(); renderMaterialCards(); updateValidation(); 
            document.addEventListener('keydown', (e) => { if (e.code === 'Space' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'SELECT' && !document.getElementById('preview-modal').classList.contains('active')) { e.preventDefault(); capturePhoto(); } }); 
            document.getElementById('pin-input').addEventListener('keydown', (e) => { if(e.key==='Enter') checkPin(); });
        });
        
        function checkAuth() { try { if(localStorage.getItem('vl_auth')===APP_PIN){ document.getElementById('pin-screen').classList.add('hidden'); data.photographer=localStorage.getItem('vl_photographer')||'P02'; document.getElementById('photographer-badge').textContent=data.photographer; startTimer(); } } catch(e){} }
        function checkPin() { if(document.getElementById('pin-input').value===APP_PIN){ try{ localStorage.setItem('vl_auth',APP_PIN); data.photographer=document.getElementById('photographer-select').value; localStorage.setItem('vl_photographer',data.photographer); document.getElementById('photographer-badge').textContent=data.photographer; }catch(e){} document.getElementById('pin-screen').classList.add('hidden'); startTimer(); } else { document.getElementById('pin-input').value=''; document.getElementById('pin-input').classList.add('shake'); setTimeout(()=>document.getElementById('pin-input').classList.remove('shake'),300); } }
        function showPinScreen() { document.getElementById('pin-screen').classList.remove('hidden'); document.getElementById('pin-input').value=''; document.getElementById('pin-input').focus(); }
        
        function goToStep(step) { currentStep = step; document.querySelectorAll('.step-container').forEach(s => s.classList.remove('active')); document.getElementById(`step-${step}`).classList.add('active'); document.querySelectorAll('.progress-dot').forEach((d,i) => { d.classList.remove('active'); if(i+1 < step) d.classList.add('complete'); else d.classList.remove('complete'); if(i+1 === step) d.classList.add('active'); }); const labels = {1:'Step 1: Tag', 2:'Step 2: Check', 3:'Step 3: Snap', 4:'Step 4: Review'}; document.getElementById('step-label').textContent = labels[step] || ''; if(step===4) updateReviewCards(); }
        
        function updateReviewCards() {
            document.getElementById('summary-tag').innerHTML = `${data.category||'?'} ‚Ä¢ ${data.tagSize||'?'}<br>${data.origin==='usa'?'üá∫üá∏ USA':data.country||''} ‚Ä¢ ${data.gender||''}`;
            document.getElementById('summary-check').innerHTML = `${data.fabricType||'?'} / ${data.material||'?'}<br>${(data.colors||[]).slice(0,3).join(', ')||'?'} ‚Ä¢ ${data.pattern||'?'}`;
            const pc = data.mainPhotos.length + data.tagPhotos.length + data.defectPhotos.length;
            document.getElementById('summary-snap').innerHTML = `${pc} photo(s)<br>${data.audioMeasure?'Audio: '+formatTime(data.audioDuration):'No audio'}`;
            document.getElementById('summary-weight').innerHTML = (data.weightLb>0||data.weightOz>0) ? `${data.weightLb} lb ${data.weightOz} oz<br>SKU: ${data.sku||'?'}` : 'No weight';
            
            setCardStatus('tag', !!data.category && !!data.tagStatus);
            setCardStatus('check', !!data.fabricType && data.colors.length>0 && !!data.pattern && !!data.material);
            setCardStatus('snap', data.mainPhotos.length>0 && !!data.audioMeasure);
            setCardStatus('weight', (data.weightLb>0 || data.weightOz>0) && !!data.sku);
        }
        function setCardStatus(name, ok) { const card = document.getElementById(`card-${name}`); const icon = document.getElementById(`icon-${name}`); card.classList.remove('card-green','card-yellow'); card.classList.add(ok?'card-green':'card-yellow'); icon.textContent = ok?'‚úÖ':'‚ö†Ô∏è'; }
        
        function startTimer() { timerStart = Date.now(); if (timerInterval) clearInterval(timerInterval); timerInterval = setInterval(updateTimerDisplay, 1000); updateTimerDisplay(); }
        function updateTimerDisplay() { if (!timerStart) return; const elapsed = Math.floor((Date.now() - timerStart) / 1000); document.getElementById('timer-current').textContent = `${Math.floor(elapsed/60)}:${(elapsed%60).toString().padStart(2,'0')}`; }
        function recordItemTime() { if (!timerStart) return; const elapsed = Math.floor((Date.now() - timerStart) / 1000); itemTimes.push(elapsed); document.getElementById('timer-last').textContent = `${Math.floor(elapsed/60)}:${(elapsed%60).toString().padStart(2,'0')}`; const avg = Math.floor(itemTimes.reduce((a,b)=>a+b,0)/itemTimes.length); document.getElementById('timer-avg').textContent = `${Math.floor(avg/60)}:${(avg%60).toString().padStart(2,'0')}`; startTimer(); }
        
        async function enumerateCameras() { 
            try { 
                await navigator.mediaDevices.getUserMedia({video:true}); 
                const devices = await navigator.mediaDevices.enumerateDevices(); 
                const videoDevices = devices.filter(d=>d.kind==='videoinput'); 
                const select = document.getElementById('camera-select'); 
                select.innerHTML = '<option value="">Select Camera...</option>'; 
                
                videoDevices.forEach((device,i)=>{ 
                    const option = document.createElement('option'); 
                    option.value = device.deviceId; 
                    option.textContent = device.label || `Camera ${i+1}`; 
                    select.appendChild(option);
                    
                    // Auto-detect cameras by name
                    const label = device.label.toLowerCase();
                    if(label.includes('brio')) {
                        mainCameraId = device.deviceId;
                        console.log('Main camera (Brio):', device.label);
                    }
                    if(label.includes('c922') || label.includes('922')) {
                        secondaryCameraId = device.deviceId;
                        console.log('Secondary camera (C922X):', device.label);
                    }
                });
                
                // Start with main camera if detected
                if(mainCameraId) {
                    select.value = mainCameraId;
                    switchCamera(mainCameraId);
                } else if(videoDevices.length > 0) {
                    // Fallback to first camera
                    mainCameraId = videoDevices[0].deviceId;
                    select.value = mainCameraId;
                    switchCamera(mainCameraId);
                }
                
                updateCameraIndicator();
            } catch(err){ console.error('Camera error:', err); } 
        }
        async function switchCamera(deviceId) { 
            if(!deviceId) return; 
            
            const video = document.getElementById('camera-video');
            
            // Add switching class for smooth transition
            video.classList.add('switching');
            
            if(currentStream) currentStream.getTracks().forEach(t=>t.stop()); 
            try { 
                // High quality settings with stabilization
                const constraints = {
                    video: {
                        deviceId: { exact: deviceId },
                        width: { ideal: 3840 },
                        height: { ideal: 2160 },
                        frameRate: { ideal: 30 },
                        // Enable stabilization on supported cameras
                        imageStabilization: true,
                        videoStabilization: true
                    }
                };
                currentStream = await navigator.mediaDevices.getUserMedia(constraints); 
                video.srcObject = currentStream; 
                video.style.display = 'block'; 
                document.getElementById('camera-placeholder').style.display = 'none'; 
                document.getElementById('camera-overlay').style.display = 'block'; 
                document.getElementById('camera-status').textContent = 'LIVE'; 
                document.getElementById('camera-status').classList.add('live'); 
                activeCameraId = deviceId;
                document.getElementById('camera-select').value = deviceId;
                
                // Log actual resolution and remove switching class
                video.onloadedmetadata = () => {
                    console.log(`Camera resolution: ${video.videoWidth}x${video.videoHeight}`);
                    document.getElementById('camera-resolution').textContent = `${video.videoWidth}√ó${video.videoHeight}`;
                    // Smooth fade in
                    setTimeout(() => video.classList.remove('switching'), 50);
                };
                
                updateCameraIndicator();
            } catch(err) { 
                console.error('Camera error:',err); 
                video.classList.remove('switching');
            } 
        }
        
        function setPhotoMode(mode) { 
            photoMode = mode; 
            document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active')); 
            document.getElementById(`mode-${mode}`).classList.add('active'); 
            
            // Auto-switch cameras based on mode
            if(mode === 'main' && mainCameraId && activeCameraId !== mainCameraId) {
                switchCamera(mainCameraId);
            } else if((mode === 'tag' || mode === 'defect' || mode === 'sku') && secondaryCameraId && activeCameraId !== secondaryCameraId) {
                switchCamera(secondaryCameraId);
            }
            
            // If SKU mode, focus the SKU input for barcode scanner
            if(mode === 'sku') {
                // Go to step 3 where SKU input is
                goToStep(3);
                // Focus SKU input after a brief delay
                setTimeout(() => {
                    const skuInput = document.getElementById('sku-input');
                    skuInput.focus();
                    skuInput.select();
                }, 100);
            }
            
            updateCameraIndicator();
        }
        
        function updateCameraIndicator() {
            const indicator = document.getElementById('camera-indicator');
            if(!indicator) return;
            if(activeCameraId === mainCameraId) {
                indicator.textContent = 'üì¶ BRIO (Main)';
                indicator.style.background = '#3b82f6';
            } else if(activeCameraId === secondaryCameraId) {
                if(photoMode === 'sku') {
                    indicator.textContent = 'üì∑ C922X (SKU Scan)';
                    indicator.style.background = '#16a34a';
                } else {
                    indicator.textContent = 'üè∑Ô∏è C922X (Tag/Defect)';
                    indicator.style.background = '#f59e0b';
                }
            } else {
                indicator.textContent = 'Camera';
                indicator.style.background = '#64748b';
            }
        }
        function capturePhoto() { 
            const video = document.getElementById('camera-video'); 
            if(!video.srcObject) return; 
            
            // Flash effect
            document.getElementById('flash-overlay').classList.add('flash'); 
            setTimeout(()=>document.getElementById('flash-overlay').classList.remove('flash'),100); 
            
            // Capture at FULL native resolution - NO DOWNSCALING
            const canvas = document.createElement('canvas'); 
            canvas.width = video.videoWidth; 
            canvas.height = video.videoHeight; 
            const ctx = canvas.getContext('2d');
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            ctx.drawImage(video, 0, 0); 
            
            // Maximum JPEG quality (0.95) for best detail preservation
            // Full 4K = ~3840x2160, perfect for AI cropping in backend
            canvas.toBlob(blob => { 
                const photo = { 
                    blob, 
                    url: URL.createObjectURL(blob), 
                    width: canvas.width, 
                    height: canvas.height 
                }; 
                if(photoMode === 'main') data.mainPhotos.push(photo); 
                else if(photoMode === 'tag') data.tagPhotos.push(photo); 
                else if(photoMode === 'sku') { /* SKU mode doesn't save photos */ }
                else data.defectPhotos.push(photo); 
                
                const sizeMB = (blob.size / 1024 / 1024).toFixed(2);
                console.log(`üì∏ ${photoMode.toUpperCase()}: ${canvas.width}√ó${canvas.height} | ${sizeMB}MB | FULL RESOLUTION`);
                
                updatePhotoGrids(); 
                updateValidation(); 
            }, 'image/jpeg', 0.95); 
        }
        function updatePhotoGrids() { 
            const renderGrid = (photos, gridId, mode) => { 
                document.getElementById(gridId).innerHTML = photos.map((p,i) => 
                    `<div class="photo-thumb" ondblclick="openPreview('${mode}',${i})" title="Double-click to preview">
                        <img src="${p.url}">
                        <button class="photo-thumb-delete" onclick="event.stopPropagation();deletePhoto('${mode}',${i})">√ó</button>
                    </div>`
                ).join('') + `<div class="photo-thumb photo-thumb-empty" onclick="setPhotoMode('${mode}')">+</div>`; 
            }; 
            renderGrid(data.mainPhotos,'main-photos-grid','main'); 
            renderGrid(data.tagPhotos,'tag-photos-grid','tag'); 
            renderGrid(data.defectPhotos,'defect-photos-grid','defect'); 
            document.getElementById('main-count').textContent = data.mainPhotos.length; 
            document.getElementById('tag-count').textContent = data.tagPhotos.length; 
            document.getElementById('defect-count').textContent = data.defectPhotos.length; 
            document.getElementById('photo-count').textContent = data.mainPhotos.length+data.tagPhotos.length+data.defectPhotos.length; 
        }
        function deletePhoto(mode,index) { if(mode==='main'){URL.revokeObjectURL(data.mainPhotos[index].url);data.mainPhotos.splice(index,1);} else if(mode==='tag'){URL.revokeObjectURL(data.tagPhotos[index].url);data.tagPhotos.splice(index,1);} else{URL.revokeObjectURL(data.defectPhotos[index].url);data.defectPhotos.splice(index,1);} updatePhotoGrids(); updateValidation(); }
        
        // Photo Preview Functions
        function openPreview(mode, index) {
            previewMode = mode;
            previewIndex = index;
            const photos = mode === 'main' ? data.mainPhotos : mode === 'tag' ? data.tagPhotos : data.defectPhotos;
            if(photos.length === 0) return;
            
            const photo = photos[index];
            document.getElementById('preview-image').src = photo.url;
            const is4K = photo.width >= 3800;
            const resLabel = photo.width ? `${photo.width}√ó${photo.height}${is4K ? ' 4K' : ''}` : '';
            document.getElementById('preview-type').textContent = mode.toUpperCase() + (resLabel ? ` ‚Ä¢ ${resLabel}` : '');
            document.getElementById('preview-type').style.background = mode === 'main' ? '#3b82f6' : mode === 'tag' ? '#f59e0b' : '#ef4444';
            updatePreviewNav();
            document.getElementById('preview-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closePreview() {
            document.getElementById('preview-modal').classList.remove('active');
            document.body.style.overflow = '';
            previewMode = null;
            previewIndex = 0;
        }
        
        function navigatePreview(dir) {
            const photos = previewMode === 'main' ? data.mainPhotos : previewMode === 'tag' ? data.tagPhotos : data.defectPhotos;
            previewIndex += dir;
            if(previewIndex < 0) previewIndex = 0;
            if(previewIndex >= photos.length) previewIndex = photos.length - 1;
            const photo = photos[previewIndex];
            document.getElementById('preview-image').src = photo.url;
            const is4K = photo.width >= 3800;
            const resLabel = photo.width ? `${photo.width}√ó${photo.height}${is4K ? ' 4K' : ''}` : '';
            document.getElementById('preview-type').textContent = previewMode.toUpperCase() + (resLabel ? ` ‚Ä¢ ${resLabel}` : '');
            updatePreviewNav();
        }
        
        function updatePreviewNav() {
            const photos = previewMode === 'main' ? data.mainPhotos : previewMode === 'tag' ? data.tagPhotos : data.defectPhotos;
            document.getElementById('preview-prev').disabled = previewIndex <= 0;
            document.getElementById('preview-next').disabled = previewIndex >= photos.length - 1;
            document.getElementById('preview-counter').textContent = `${previewIndex + 1} / ${photos.length}`;
        }
        
        function deleteFromPreview() {
            if(!previewMode) return;
            deletePhoto(previewMode, previewIndex);
            const photos = previewMode === 'main' ? data.mainPhotos : previewMode === 'tag' ? data.tagPhotos : data.defectPhotos;
            if(photos.length === 0) {
                closePreview();
                return;
            }
            if(previewIndex >= photos.length) previewIndex = photos.length - 1;
            const photo = photos[previewIndex];
            document.getElementById('preview-image').src = photo.url;
            const is4K = photo.width >= 3800;
            const resLabel = photo.width ? `${photo.width}√ó${photo.height}${is4K ? ' 4K' : ''}` : '';
            document.getElementById('preview-type').textContent = previewMode.toUpperCase() + (resLabel ? ` ‚Ä¢ ${resLabel}` : '');
            updatePreviewNav();
        }
        
        // Keyboard navigation for preview
        document.addEventListener('keydown', (e) => {
            if(document.getElementById('preview-modal').classList.contains('active')) {
                if(e.key === 'Escape') closePreview();
                if(e.key === 'ArrowLeft') navigatePreview(-1);
                if(e.key === 'ArrowRight') navigatePreview(1);
                if(e.key === 'Delete' || e.key === 'Backspace') deleteFromPreview();
            }
        });
        
        function setSuperCategory(cat, btn) { data.superCategory = cat; data.category = ''; document.querySelectorAll('.super-btn').forEach(b => { b.classList.remove('selected','btn-hero'); b.classList.add('btn-secondary'); }); btn.classList.add('selected','btn-hero'); btn.classList.remove('btn-secondary'); renderSubCategories(cat); updateValidation(); }
        function renderSubCategories(superCat) { const config = categoryConfig[superCat]; const container = document.getElementById('sub-categories'); container.innerHTML = `<button onclick="setCategory('${config.heroes[0]}', this)" class="cat-hero cat-btn cat-default"><span style="font-size:20px;">${catEmojis[config.heroes[0]]||'üëï'}</span> ${config.heroes[0].toUpperCase()}</button><div class="btn-grid btn-grid-2" style="margin-bottom:8px;">${config.heroes.slice(1).map(c=>`<button onclick="setCategory('${c}', this)" class="cat-secondary cat-btn"><span>${catEmojis[c]||'üëï'}</span> ${c}</button>`).join('')}</div><div class="btn-grid btn-grid-4">${config.others.map(c=>`<button onclick="setCategory('${c}', this)" class="cat-other cat-btn">${c}</button>`).join('')}</div>`; }
        function setCategory(cat, btn) { data.category = cat; document.querySelectorAll('.cat-btn').forEach(b => { b.classList.remove('selected'); if(b.classList.contains('cat-hero')) b.classList.add('cat-default'); }); btn.classList.add('selected'); btn.classList.remove('cat-default'); document.getElementById('category-label').textContent = '‚Äî ' + cat.toUpperCase(); renderFabricCards(); renderMaterialCards(); updateValidation(); }
        
        function setTagStatus(status, btn) { data.tagStatus = status; document.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); document.getElementById('tag-details').classList.toggle('hidden', status !== 'has'); document.getElementById('material-tag-warning').classList.toggle('hidden', status === 'has'); updateValidation(); }
        function setSize(size, btn) { data.tagSize = size; document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function setOrigin(origin, btn) { data.origin = origin; document.querySelectorAll('.origin-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); document.getElementById('country-section').classList.toggle('hidden', origin !== 'import'); if(origin==='usa')data.country='USA'; }
        function setCountry(country, btn) { data.country = country; document.querySelectorAll('.country-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function setGender(gender, btn) { data.gender = gender; document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function toggleColor(color, btn) { const idx = data.colors.indexOf(color); if(idx>-1){data.colors.splice(idx,1);btn.classList.remove('selected');} else{data.colors.push(color);btn.classList.add('selected');} updateValidation(); }
        function setFade(fade, btn) { data.fade = fade; document.querySelectorAll('.fade-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); updateValidation(); }
        function setPattern(pattern, btn) { data.pattern = pattern; document.querySelectorAll('.pattern-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); updateValidation(); }
        function setSleeve(length, btn) { data.sleeveLength = length; document.querySelectorAll('.sleeve-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); document.getElementById('sleeve-style-section').classList.toggle('hidden', length==='None'); updateValidation(); }
        function setSleeveStyle(style, btn) { data.sleeveStyle = style; document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function setStitch(stitch, btn) { data.stitch = stitch; document.querySelectorAll('.stitch-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function setThickness(thickness, btn) { data.thickness = thickness; document.querySelectorAll('.thickness-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); updateValidation(); }
        function setLayers(layers, btn) { data.layers = layers; document.querySelectorAll('.layers-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); updateValidation(); }
        function setWash(wash, btn) { data.wash = wash; document.querySelectorAll('.wash-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }
        function setClean(btn) { data.hasDefects = false; data.defectTypes = []; document.getElementById('btn-clean').classList.add('selected'); document.querySelectorAll('.defect-type-btn').forEach(b => b.classList.remove('selected')); updateValidation(); }
        function toggleDefect(type, btn) { document.getElementById('btn-clean').classList.remove('selected'); data.hasDefects = true; const idx = data.defectTypes.indexOf(type); if(idx>-1){data.defectTypes.splice(idx,1);btn.classList.remove('selected');} else{data.defectTypes.push(type);btn.classList.add('selected');} if(data.defectTypes.length===0){data.hasDefects=null;} updateValidation(); }
        function updateWeight() { data.weightLb = parseInt(document.getElementById('weight-lb').value); data.weightOz = parseInt(document.getElementById('weight-oz').value); updateValidation(); }
        
        function onSkuInput() {
            const skuInput = document.getElementById('sku-input');
            data.sku = skuInput.value.trim();
            
            // Update SKU badge in progress bar
            const skuBadge = document.getElementById('sku-badge');
            if(data.sku) {
                skuBadge.textContent = 'SKU: ' + data.sku;
                skuBadge.classList.add('visible');
            } else {
                skuBadge.classList.remove('visible');
            }
            
            updateValidation();
        }
        
        // Audio Recording
        async function toggleRecording() {
            if(mediaRecorder && mediaRecorder.state === 'recording') { stopRecording(); return; }
            try {
                const stream = await navigator.mediaDevices.getUserMedia({audio:true});
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const blob = new Blob(audioChunks, {type:'audio/webm'});
                    data.audioMeasure = blob;
                    stream.getTracks().forEach(t => t.stop());
                    updateValidation();
                };
                mediaRecorder.start();
                recordingStart = Date.now();
                document.getElementById('record-btn').innerHTML = '<span style="font-size:24px;">‚èπÔ∏è</span><span>RECORDING...</span>';
                document.getElementById('record-btn').style.background = '#dc2626';
                document.getElementById('record-btn').classList.add('recording');
                recordingInterval = setInterval(updateRecordingTime, 1000);
            } catch(e) { alert('Microphone access denied'); }
        }
        function stopRecording() {
            if(mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                clearInterval(recordingInterval);
                const duration = Math.floor((Date.now() - recordingStart) / 1000);
                data.audioDuration = duration;
                document.getElementById('recording-duration').textContent = formatTime(duration);
                document.getElementById('record-section').classList.add('hidden');
                document.getElementById('post-record-section').classList.remove('hidden');
            }
        }
        function updateRecordingTime() {
            const elapsed = Math.floor((Date.now() - recordingStart) / 1000);
            document.getElementById('record-btn').querySelector('span:last-child').textContent = `RECORDING ${formatTime(elapsed)}`;
        }
        function reRecord() {
            data.audioMeasure = null; data.audioDuration = 0;
            document.getElementById('record-section').classList.remove('hidden');
            document.getElementById('post-record-section').classList.add('hidden');
            document.getElementById('record-btn').innerHTML = '<span style="font-size:24px;">üé§</span><span>TAP TO RECORD</span>';
            document.getElementById('record-btn').style.background = '#ef4444';
            document.getElementById('record-btn').classList.remove('recording');
            updateValidation();
        }
        function formatTime(s) { return `${Math.floor(s/60)}:${(s%60).toString().padStart(2,'0')}`; }
        
        function renderFabricCards() { const grid = document.getElementById('fabric-cards-grid'); const fabrics = fabricDB[data.category] || fabricDB['default']; grid.innerHTML = ''; fabrics.forEach(fab=>{ let dimmed = false; if(fabricFilters.stretch&&fab.traits.stretch!==fabricFilters.stretch)dimmed=true; if(fabricFilters.interior&&fab.traits.interior!==fabricFilters.interior)dimmed=true; const card = document.createElement('div'); card.className = `card ${fab.default?'priority-1':''} ${data.fabricType===fab.name?'selected':''} ${dimmed?'dimmed':''}`; card.innerHTML = `<button class="card-help" onclick="event.stopPropagation();">?</button><div class="card-name">${fab.name}</div><div class="card-desc">${fab.desc}</div>`; if(!dimmed)card.onclick = ()=>{ data.fabricType=fab.name; document.getElementById('wash-section').classList.toggle('hidden', fab.name!=='Denim'); renderFabricCards(); updateValidation(); }; grid.appendChild(card); }); }
        function toggleFabricHelp() { document.getElementById('fabric-help-panel').classList.toggle('hidden'); }
        function toggleFabricFilter(type, value, btn) { if(fabricFilters[type]===value){fabricFilters[type]=null;btn.classList.remove('active');} else{fabricFilters[type]=value;btn.parentElement.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');} renderFabricCards(); const helper = document.getElementById('fabric-helper'); let advice = ''; if(fabricFilters.interior==='fuzzy')advice='üí° Fuzzy inside = Fleece'; else if(fabricFilters.interior==='loops')advice='üí° Loops inside = French Terry'; if(advice){helper.innerHTML=advice;helper.classList.remove('hidden');} else helper.classList.add('hidden'); }
        
        function renderMaterialCards() { const grid = document.getElementById('material-cards-grid'); const materials = materialDB[data.category] || materialDB['default']; grid.innerHTML = ''; materials.forEach(mat=>{ let dimmed = false; if(materialFilters.temp&&mat.traits.temp!==materialFilters.temp)dimmed=true; if(materialFilters.shine&&mat.traits.shine!==materialFilters.shine)dimmed=true; const card = document.createElement('div'); card.className = `card ${mat.default?'priority-1':''} ${data.material===mat.name?'selected':''} ${dimmed?'dimmed':''}`; card.innerHTML = `<button class="card-help" onclick="event.stopPropagation();">?</button><div class="card-name">${mat.name}</div><div class="card-desc">${mat.desc}</div>`; if(!dimmed)card.onclick = ()=>{ data.material=mat.name; renderMaterialCards(); updateValidation(); }; grid.appendChild(card); }); }
        function toggleMaterialHelp() { document.getElementById('material-help-panel').classList.toggle('hidden'); }
        function toggleMaterialFilter(type, value, btn) { if(materialFilters[type]===value){materialFilters[type]=null;btn.classList.remove('active');} else{materialFilters[type]=value;btn.parentElement.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');} renderMaterialCards(); const helper = document.getElementById('material-helper'); let advice = ''; if(materialFilters.temp==='cool'&&materialFilters.shine==='matte')advice='üí° Likely Cotton!'; else if(materialFilters.temp==='warm'&&materialFilters.shine==='sheen')advice='üí° Likely Polyester'; if(advice){helper.innerHTML=advice;helper.classList.remove('hidden');} else helper.classList.add('hidden'); }
        
        function updateValidation() { 
            const checks = { category:!!data.category, tag:!!data.tagStatus, color:data.colors.length>0, fade:!!data.fade, pattern:!!data.pattern, 'fabric-type':!!data.fabricType, material:!!data.material, construction:!!data.sleeveLength, feel:!!data.thickness&&!!data.layers, condition:data.hasDefects!==null, weight:data.weightLb>0||data.weightOz>0, audio:!!data.audioMeasure, sku:!!data.sku }; 
            Object.entries(checks).forEach(([key,ok])=>{ const el = document.getElementById(`check-${key}`); if(el){el.innerHTML=ok?'‚úì':'‚óã';el.classList.toggle('complete',ok);} }); 
            const allRequired = checks.category&&checks.tag&&checks.color&&checks.fade&&checks.pattern&&checks['fabric-type']&&checks.material&&checks.construction&&checks.feel&&checks.condition&&checks.weight&&checks.audio&&checks.sku; 
            const hasPhotos = data.mainPhotos.length>0; 
            document.getElementById('submit-btn').disabled = !(allRequired&&hasPhotos);
            if(currentStep===4) updateReviewCards();
        }
        
        function submitItem() { 
            if(!data.sku) { alert('Enter SKU'); return; }
            if(data.mainPhotos.length===0) { alert('Add at least one photo'); return; }
            if(data.weightLb===0 && data.weightOz===0) { alert('Enter weight'); return; }
            if(!data.audioMeasure) { alert('Record measurements'); return; }
            
            // Send to n8n webhook
            const formData = new FormData();
            formData.append('sku', data.sku);
            formData.append('category', data.category);
            formData.append('superCategory', data.superCategory);
            formData.append('tagStatus', data.tagStatus);
            formData.append('tagSize', data.tagSize);
            formData.append('origin', data.origin);
            formData.append('country', data.country);
            formData.append('gender', data.gender);
            formData.append('colors', JSON.stringify(data.colors));
            formData.append('fade', data.fade);
            formData.append('pattern', data.pattern);
            formData.append('fabricType', data.fabricType);
            formData.append('wash', data.wash);
            formData.append('material', data.material);
            formData.append('sleeveLength', data.sleeveLength);
            formData.append('sleeveStyle', data.sleeveStyle);
            formData.append('stitch', data.stitch);
            formData.append('thickness', data.thickness);
            formData.append('layers', data.layers);
            formData.append('hasDefects', data.hasDefects);
            formData.append('defectTypes', JSON.stringify(data.defectTypes));
            formData.append('weightLb', data.weightLb);
            formData.append('weightOz', data.weightOz);
            formData.append('photographer', data.photographer);
            formData.append('audioDuration', data.audioDuration);
            if(data.audioMeasure) formData.append('audio', data.audioMeasure, 'measurements.webm');
            data.mainPhotos.forEach((p,i) => formData.append(`mainPhoto${i}`, p.blob, `main${i}.jpg`));
            data.tagPhotos.forEach((p,i) => formData.append(`tagPhoto${i}`, p.blob, `tag${i}.jpg`));
            data.defectPhotos.forEach((p,i) => formData.append(`defectPhoto${i}`, p.blob, `defect${i}.jpg`));
            
            const xhr = new XMLHttpRequest();
            xhr.open('POST', N8N_WEBHOOK_URL, true);
            xhr.onload = () => { if(xhr.status===200) { console.log('Submitted to n8n'); } };
            xhr.onerror = () => { console.error('Webhook error'); };
            xhr.send(formData);
            
            recordItemTime(); stats.today++; stats.week++; stats.total++; saveStats(); updateStatsDisplay(); console.log('Submitted:',data); resetForm(); 
        }
        function resetForm() { data.mainPhotos.forEach(p=>URL.revokeObjectURL(p.url)); data.tagPhotos.forEach(p=>URL.revokeObjectURL(p.url)); data.defectPhotos.forEach(p=>URL.revokeObjectURL(p.url)); data = {superCategory:'tops',category:'',tagStatus:'',tagSize:'',origin:'',country:'',gender:'',colors:[],fade:'',pattern:'',fabricType:'',wash:'',material:'',sleeveLength:'',sleeveStyle:'',stitch:'',thickness:'',layers:'',hasDefects:null,defectTypes:[],weightLb:0,weightOz:0,sku:'',photographer:data.photographer,audioMeasure:null,audioDuration:0,mainPhotos:[],tagPhotos:[],defectPhotos:[]}; document.querySelectorAll('.selected').forEach(b=>b.classList.remove('selected')); document.querySelectorAll('.super-btn').forEach((b,i)=>{if(i===0){b.classList.add('selected','btn-hero');b.classList.remove('btn-secondary');}else{b.classList.remove('selected','btn-hero');b.classList.add('btn-secondary');}}); document.getElementById('sku-input').value=''; document.getElementById('weight-lb').value='0'; document.getElementById('weight-oz').value='0'; document.getElementById('tag-details').classList.add('hidden'); document.getElementById('country-section').classList.add('hidden'); document.getElementById('wash-section').classList.add('hidden'); document.getElementById('record-section').classList.remove('hidden'); document.getElementById('post-record-section').classList.add('hidden'); document.getElementById('record-btn').innerHTML='<span style="font-size:24px;">üé§</span><span>TAP TO RECORD</span>'; document.getElementById('record-btn').style.background='#ef4444'; document.getElementById('category-label').textContent=''; document.getElementById('sku-badge').classList.remove('visible'); document.getElementById('sku-badge').textContent=''; fabricFilters={stretch:null,interior:null}; materialFilters={temp:null,shine:null}; document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active')); renderSubCategories('tops'); renderFabricCards(); renderMaterialCards(); updatePhotoGrids(); updateValidation(); goToStep(1); setPhotoMode('main'); }
        
        function loadStats() { try{ const saved = JSON.parse(localStorage.getItem('vl_stats_v98')||'{}'); if(saved.date!==new Date().toDateString()){saved.today=0;} stats = {today:saved.today||0,week:saved.week||0,total:saved.total||0}; itemTimes = saved.itemTimes||[]; updateStatsDisplay(); if(itemTimes.length>0){ const avg = Math.floor(itemTimes.reduce((a,b)=>a+b,0)/itemTimes.length); document.getElementById('timer-avg').textContent = `${Math.floor(avg/60)}:${(avg%60).toString().padStart(2,'0')}`; } }catch(e){} }
        function saveStats() { try{localStorage.setItem('vl_stats_v98',JSON.stringify({...stats,date:new Date().toDateString(),itemTimes:itemTimes.slice(-50)}));}catch(e){} }
        function updateStatsDisplay() { document.getElementById('stat-today').textContent = stats.today; document.getElementById('stat-week').textContent = stats.week; document.getElementById('stat-total').textContent = stats.total; }
    </script>
</body>
</html>
